<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		小型APT之看我如何入侵电视  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		小型APT之看我如何入侵电视  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/Hxai11">Hxai11</a> 
</li><li>提交时间：		2013-06-01 12:19</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2013-06-01：	细节已通知厂商并且等待厂商处理中<br/>
									2013-06-06：	厂商已经确认，细节仅向厂商公开<br/>
									2013-06-16：	细节向核心白帽子及相关领域专家公开<br/>
									2013-06-26：	细节向普通白帽子公开<br/>
									2013-07-06：	细节向实习白帽子公开<br/>
									2013-07-16：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">小型APT</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">这么多年来，我只看国少许的对于电视机的入侵，现在在这个日益智能化的是时代里，什么都智能，什么都联网，这就对看似安全的智能化生活埋下了隐患，这次就针对天威视讯的机顶盒进行电视机的渗透。。不要惊奇，就是电视机。。<br />
<br />
<br />
<br />
关于天威视讯的介绍，深圳几乎一半的电视终端都是使用天威视讯的，庞大的用户量，一旦发生问题，后果严重。。<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
首先，这次渗透也是我突发奇想，看到电视机里有个ip设置的选项，和机顶盒背后那个网线插口二萌生的，我就在想，如果将网线插入电脑，会不会获取到一样的ip？于是我将插入电脑，这个时候我发现，如果你的机顶盒开机后插入网线到电脑，获取不到ip的，一定要将机顶盒关机后，插入网线，之后在开启机顶盒就能够正常获取到ip网关等一系列的信息，于是。。之后大型的渗透就开始了。。。<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
上张机顶盒背后的图<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01113002521f61c3923e874c2b25c884fec5e8fa.jpg" target="_blank"><img src="../images/01113002521f61c3923e874c2b25c884fec5e8fa.jpg" alt="P30525-101818.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
真是智能化啊。<br />
<br />
<br />
<br />
于是我查看了ip<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01113413b7fc3e3a251b4ae23ea8bc59e69e64ff.png" target="_blank"><img src="../images/01113413b7fc3e3a251b4ae23ea8bc59e69e64ff.png" alt="捕获.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
Ip是以10.97.143这个段，而网关是10.97.128.1，dhcp服务器则是192.168.222.105，dns是172.18.50.11和172.16.129.12，看到此画面的时候，我知道，这是个超级大的局域网，在电视中测试的时候，本来以为能够连接到外网，其实是这样的，如此便于生活的机顶盒，里面包含了很多便民服务，我在想，便民服务，如汽车违规查询，那查询应该是要连接外网的，但是在我实际测试之中，我发现，其实是这样的，我们本机利用遥控板点开查询页面，看是连接到了外网，其实呢，是连接到了天威自己制作的一个查询页面，当然，这个查询页面的服务器是连接外网的，也就是说，你本身10.97.143.254这个ip是不能够连接外网的，在我电脑上测试就证明了这点<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/0111350407a8d644c3add503e71f37f827c3bf60.png" target="_blank"><img src="../images/0111350407a8d644c3add503e71f37f827c3bf60.png" alt="gt.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
Ping 了百度的域名，ip，和qq的域名，浏览器里也测试了是否能够访问，都不行，由此可以初步判断是这样的，那我们该从和处开始下手呢，我选择就从本机的ip段开始探索<br />
<br />
<br />
<br />
我将10.97.143这个段填入IISPUT中进行对端口80,8080,23,22的扫描。。。<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011135274978fbc86bdf6a4c0d74bf143e3bd897.png" target="_blank"><img src="../images/011135274978fbc86bdf6a4c0d74bf143e3bd897.png" alt="sddf.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
看到了吗，都是80端口，23端口，我随即打开了一个页面查看<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/0111355036acfcebf51f97558f717061eefbe6a2.png" target="_blank"><img src="../images/0111355036acfcebf51f97558f717061eefbe6a2.png" alt="dddf.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
要求验证，试了试常用的弱口令，都不能够登陆，我们现在可以推断，这些扫描肯定是跟电有关的，正在我郁闷的时候，想起了上面扫描的23端口可以测试，用telnet测试连接<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011136309a92d62801fb7f15e45f149c34cb6a57.png" target="_blank"><img src="../images/011136309a92d62801fb7f15e45f149c34cb6a57.png" alt="捕dgsd.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
Ok，可以连接，我猜测了常用的默认密码等。。终于在我尝试到root 空密码的时候成功了，我擦，郁闷死我。。。<br />
<br />
<br />
<br />
登陆成功<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011136481f8c73a58bbd2ceb929378988a9b9663.png" target="_blank"><img src="../images/011136481f8c73a58bbd2ceb929378988a9b9663.png" alt="vfd.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
初步推测应该是智能机顶盒的终端。。。但是在随后的测试中，我发现，我错了。。。，通过web访问得知，需要登录，那就应该是路由器之类的。。不急，我首先阅遍了终端下的所有文件，找寻进一步渗透的游泳的东西。。之后我突然发现了这个。。看<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011138156db5bab4b6f8db8d1da3a964cead1e11.png" target="_blank"><img src="../images/011138156db5bab4b6f8db8d1da3a964cead1e11.png" alt="dfgfg.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
看到了吗，action，心里想，肯定存在Struts命令执行漏洞，于是，丢进利用工具里跑，与此同时，我发现了进入路由的方法，其实天威的验证做的很坑爹，天威的web验证界面其实就只是针对了home.asp这个页面而已，其他任何页面目录都形同虚设所以我们可以找到更改密码的地方，直接修改admin密码<br />
<br />
<br />
<br />
adm/management.asp 这个页面是修改密码的<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01113836c5a87d2c557ce57cc51093c0d5ce21e4.png" target="_blank"><img src="../images/01113836c5a87d2c557ce57cc51093c0d5ce21e4.png" alt="fgf.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
看到了吗<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011139023ee62b775de3a2379215e4e83dcd706c.png" target="_blank"><img src="../images/011139023ee62b775de3a2379215e4e83dcd706c.png" alt="scvdd.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
我初步扫描了一下，最少都有1000多台，我们可以利用此漏洞控制成千甚至上万的无线路由器，危害可想而知<br />
<br />
<br />
<br />
我们回到那个Struts漏洞上来，我测试了一些，存在Struts命令执行漏洞。我擦，人品大爆发，好玩的来了，兴奋<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/0111392346a17878090ef52d778c7fadb5afc088.png" target="_blank"><img src="../images/0111392346a17878090ef52d778c7fadb5afc088.png" alt="sdsdvd.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114013a8145af350a5a1cd0aa3c84b6c8f043a.jpg" target="_blank"><img src="../images/01114013a8145af350a5a1cd0aa3c84b6c8f043a.jpg" alt="P30526-104350.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
你知道我为什么看到这张图兴奋吗？因为这是电视机上显示的画面，一些未交钱的电视节目就是这个提示，这样我们就能够成功修改标题，入侵电视的目的达到<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114110d65f7e9f49c4d4c36926317c35394205.png" target="_blank"><img src="../images/01114110d65f7e9f49c4d4c36926317c35394205.png" alt="dfgvfd.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
继续进一步渗透由此从dhcp服务器着手<br />
<br />
<br />
<br />
本机的dhcp服务器是192.168.222.105，我抱着试试的心态扫描了一下关于192.168.222.105这个网段的ip，看看有什么可以利用的。。<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114126e646ede058d0b5e797eb83cbd19d2873.png" target="_blank"><img src="../images/01114126e646ede058d0b5e797eb83cbd19d2873.png" alt="asslp.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
哇塞，兴奋了，这么多ip，直到我找到这个ip<br />
<br />
</p><p class="detail"><a href="../images/01114145b290692d115794f06050faf54331c51c.png" target="_blank"><img src="../images/01114145b290692d115794f06050faf54331c51c.png" alt="sdss.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
看到没有，又是一个action后缀的文件，赶紧放工具里面跑跑看，有没有Struts命令执行漏洞，事实表明，有的，于是赶紧跑出登陆用户名和密码<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114207941d714a6d34cc32a076166653ec78e2.png" target="_blank"><img src="../images/01114207941d714a6d34cc32a076166653ec78e2.png" alt="dfdji.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
进来之后就觉得碉堡了，基本上，天威的所有ip我都能够查询的到<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011142337a7692b1ebb1953b83b6fe8cbf933849.png" target="_blank"><img src="../images/011142337a7692b1ebb1953b83b6fe8cbf933849.png" alt="sgdf.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114252e5aa7a1032129108bffe09f62bb46696.png" target="_blank"><img src="../images/01114252e5aa7a1032129108bffe09f62bb46696.png" alt="gfhfg.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
能够查询到任意一台机顶盒的上线记录等。。为了进一步的渗透，我添加了一个管理员账户，之后登陆上3389之后，之后当我用administrator用户登陆之后，打开Navicat for Mysql软件的时候，众多数据库暴漏。<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114310ecff41b1e4288d7b6b8005a1cc502593.png" target="_blank"><img src="../images/01114310ecff41b1e4288d7b6b8005a1cc502593.png" alt="dsg.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
可想而知的危害。。看看这下载速度<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/01114328014b1ef85dac00cec3acf13aad1f95ec.png" target="_blank"><img src="../images/01114328014b1ef85dac00cec3acf13aad1f95ec.png" alt="asd.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
当我查看共享的时候，吓尿了。。。全是企业内部资料。。<br />
<br />
</p><p class="detail"><a href="../images/01114538105df40607d4104c9b7e58926c0c83e7.png" target="_blank"><img src="../images/01114538105df40607d4104c9b7e58926c0c83e7.png" alt="sdfs.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
如果这些资料泄露不堪设想<br />
<br />
<br />
<br />
看看这些<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/011145585f70f6426f433debb87c94afd1a12439.png" target="_blank"><img src="../images/011145585f70f6426f433debb87c94afd1a12439.png" alt="dvxr.PNG" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
全是ims设备。都能够登陆的。。<br />
<br />
<br />
<br />
各种的信息泄露<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/191234563f2d4129e079023391dc2758529dba2d.png" target="_blank"><img src="../images/191234563f2d4129e079023391dc2758529dba2d.png" alt="123456.png" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
到这里，我们的渗透基本完成，但是还能够进一步深入，但是由于信息量实在太大，就不在wooyun上多说，算是个小型apt吧<br />
<br />
 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail"> </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">安全意识,访问控制等。。 </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/Hxai11" title="Hxai11">Hxai11</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-024933" title="小型APT之看我如何入侵电视">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：高</p>
						<p class="detail">漏洞Rank：20 </p>
													<p class="detail">确认时间：2013-06-06 00:50</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail"> </p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="24933";
var bugRating="2";
var myRating="";
var ratingCount="10";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
