<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		anwsion一个类设置缺陷导致安全过滤失效，附带一个利用案例  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		anwsion一个类设置缺陷导致安全过滤失效，附带一个利用案例  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/_Evil">_Evil</a> 
</li><li>提交时间：		2012-11-28 18:52</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2012-11-28：	细节已通知厂商并且等待厂商处理中<br/>
									2012-12-02：	厂商已经确认，细节仅向厂商公开<br/>
									2012-12-12：	细节向核心白帽子及相关领域专家公开<br/>
									2012-12-22：	细节向普通白帽子公开<br/>
									2013-01-01：	细节向实习白帽子公开<br/>
									2013-01-12：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">anwsion一个类设置缺陷。哎。。。。</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">真心蛋疼！！！！！<br />
<br />
<br />
<br />
models/system.php<br />
<br />
<br />
<br />
</p><pre><code>public function analysis_keyword($string)<br />
	{<br />
		$string = str_replace(array(<br />
			&quot;~&quot;, <br />
			&quot;!&quot;, <br />
			&quot;@&quot;, <br />
			&quot;#&quot;, <br />
			&quot;$&quot;, <br />
			&quot;%&quot;, <br />
			&quot;^&quot;, <br />
			&quot;&amp;&quot;, <br />
			&quot;*&quot;, <br />
			&quot;,&quot;, <br />
			&quot;.&quot;, <br />
			&quot;?&quot;, <br />
			&quot;;&quot;, <br />
			&quot;:&quot;, <br />
			&quot;&#039;&quot;, <br />
			&#039;&quot;&#039;, <br />
			&quot;[&quot;, <br />
			&quot;]&quot;, <br />
			&quot;{&quot;, <br />
			&quot;}&quot;, <br />
			&quot;！&quot;, <br />
			&quot; ￥&quot;, <br />
			&quot;……&quot;, <br />
			&quot;…&quot;, <br />
			&quot;、&quot;, <br />
			&quot;，&quot;, <br />
			&quot;。&quot;, <br />
			&quot;？&quot;, <br />
			&quot;；&quot;, <br />
			&quot;：&quot;, <br />
			&quot;‘&quot;, <br />
			&quot;“&quot;, <br />
			&quot;”&quot;, <br />
			&quot;’&quot;, <br />
			&quot; 【&quot;, <br />
			&quot;】&quot;, <br />
			&quot;～&quot;, <br />
			&quot;！&quot;, <br />
			&quot;＠&quot;, <br />
			&quot;＃&quot;, <br />
			&quot;＄&quot;, <br />
			&quot;％&quot;, <br />
			&quot;＾&quot;, <br />
			&quot;＆&quot;, <br />
			&quot;＊&quot;, <br />
			&quot;，&quot;, <br />
			&quot;．&quot;, <br />
			&quot; ＜&quot;, <br />
			&quot;＞&quot;, <br />
			&quot;；&quot;, <br />
			&quot;：&quot;, <br />
			&quot;＇&quot;, <br />
			&quot;＂&quot;, <br />
			&quot;［&quot;, <br />
			&quot;］&quot;, <br />
			&quot;｛&quot;, <br />
			&quot;｝&quot;, <br />
			&quot;／&quot;, <br />
			&quot;＼&quot;<br />
		), &#039;&#039;, $string);<br />
		<br />
		$analysis = new Services_Phpanalysis_Phpanalysis();<br />
		<br />
		$analysis-&gt;SetSource(strtolower($string));<br />
		$analysis-&gt;StartAnalysis();<br />
		<br />
		$final_result = $analysis-&gt;GetFinallyResult(&#039;,&#039;);<br />
		<br />
		$final_result = explode(&#039;,&#039;, $final_result);<br />
		<br />
		if (is_array($final_result))<br />
		{			<br />
			$final_result = array_unique($final_result);<br />
			<br />
			foreach ($final_result as $key =&gt; $keyword)<br />
			{			<br />
				if (!$this-&gt;check_stop_keyword($keyword))<br />
				{<br />
					unset($final_result[$key]);<br />
				}<br />
				else<br />
				{<br />
					$final_result[$key] = trim($keyword);<br />
				}<br />
			}<br />
		}<br />
		<br />
		return $final_result;<br />
	}<br />
}</code></pre><p class='detail'><br />
<br />
<br />
<br />
缺陷1:)圆角的。。。。<br />
<br />
<br />
<br />
缺陷2:)正则根本没有来匹配。。。<br />
<br />
<br />
<br />
你们过滤是这个:<br />
<br />
check_stop_keyword类:<br />
<br />
</p><pre><code>public function check_stop_keyword($keyword)<br />
	{<br />
		if (trim($keyword) == &#039;&#039;)<br />
		{<br />
			return false;<br />
		}<br />
		<br />
		if (cjk_strlen($keyword) == 1)<br />
		{<br />
			return false;<br />
		}<br />
		<br />
		if (strstr($keyword, &#039;了&#039;) OR strstr($keyword, &#039;的&#039;) OR strstr($keyword, &#039;有&#039;))<br />
		{<br />
			return false;<br />
		}<br />
		<br />
		static $stop_words_list;<br />
		<br />
		if (!$stop_words_list)<br />
		{<br />
			$stop_words_list = array(<br />
				&#039;?&#039;, &#039;、&#039;, &#039;。&#039;, &#039;“&#039;, &#039;”&#039;, &#039;《&#039;, &#039;》&#039;, &#039;！&#039;, &#039;，&#039;, &#039;：&#039;, &#039;；&#039;, &#039;？&#039;, &#039;末&#039;, &#039;啊&#039;, &#039;阿&#039;, &#039;哎&#039;, &#039;哎呀&#039;, &#039;哎哟&#039;, &#039;唉&#039;, &#039;俺&#039;, &#039;俺们&#039;, &#039;按&#039;, &#039;按照&#039;, &#039;吧&#039;, &#039;吧哒&#039;, &#039;把&#039;, &#039;被&#039;, &#039;本&#039;, &#039;本着&#039;, &#039;比&#039;, &#039;比方&#039;, &#039;比如&#039;, &#039;鄙人&#039;, &#039;彼&#039;, &#039;彼此&#039;, &#039;边&#039;, &#039;别&#039;, &#039;别说&#039;, &#039;并&#039;, &#039;并且&#039;, &#039;不比&#039;, &#039;不成&#039;, &#039;不单&#039;, &#039;不但&#039;, &#039;不独&#039;, &#039;不管&#039;, &#039;不光&#039;, &#039;不过&#039;, &#039;不仅&#039;, &#039;不拘&#039;, &#039;不论&#039;, &#039;不怕&#039;, &#039;不然&#039;, &#039;不如&#039;, &#039;不特&#039;, &#039;不惟&#039;, &#039;不问&#039;, &#039;不只&#039;, &#039;朝&#039;, &#039;朝着&#039;, &#039;趁&#039;, &#039;趁着&#039;, &#039;乘&#039;, &#039;冲&#039;, &#039;除&#039;, &#039;除此之外&#039;, &#039;除非&#039;, &#039;此&#039;, &#039;此间&#039;, &#039;此外&#039;, &#039;从&#039;, &#039;从而&#039;, &#039;打&#039;, &#039;待&#039;, &#039;但&#039;, &#039;但是&#039;, &#039;当&#039;, &#039;当着&#039;, &#039;到&#039;, &#039;得&#039;, &#039;等&#039;, &#039;等等&#039;, &#039;地&#039;, &#039;第&#039;, &#039;叮咚&#039;, &#039;对&#039;, &#039;对于&#039;, &#039;多&#039;, &#039;多少&#039;, &#039;而&#039;, &#039;而况&#039;, &#039;而且&#039;, &#039;而是&#039;, &#039;而外&#039;, &#039;而言&#039;, &#039;而已&#039;, &#039;尔后&#039;, &#039;反过来&#039;, &#039;反过来说&#039;, &#039;反之&#039;, &#039;非但&#039;, &#039;非徒&#039;, &#039;否则&#039;, &#039;嘎&#039;, &#039;嘎登&#039;, &#039;该&#039;, &#039;赶&#039;, &#039;个&#039;, &#039;各&#039;, &#039;各个&#039;, &#039;各位&#039;, &#039;各种&#039;, &#039;各自&#039;, &#039;给&#039;, &#039;根据&#039;, &#039;跟&#039;, &#039;故&#039;, &#039;故此&#039;, &#039;固然&#039;, &#039;关于&#039;, &#039;管&#039;, &#039;归&#039;, &#039;果然&#039;, &#039;果真&#039;, &#039;过&#039;, &#039;哈&#039;, &#039;哈哈&#039;, &#039;呵&#039;, &#039;和&#039;, &#039;何&#039;, &#039;何处&#039;, &#039;何况&#039;, &#039;何时&#039;, &#039;嘿&#039;, &#039;哼&#039;, &#039;哼唷&#039;, &#039;呼哧&#039;, &#039;乎&#039;, &#039;哗&#039;, &#039;还是&#039;, &#039;换句话说&#039;, &#039;换言之&#039;, &#039;或&#039;, &#039;或是&#039;, &#039;或者&#039;, &#039;及&#039;, &#039;及其&#039;, &#039;及至&#039;, &#039;即&#039;, &#039;即便&#039;, &#039;即或&#039;, &#039;即令&#039;, &#039;即若&#039;, &#039;即使&#039;, &#039;几&#039;, &#039;几时&#039;, &#039;己&#039;, &#039;既&#039;, &#039;既然&#039;, &#039;既是&#039;, &#039;继而&#039;, &#039;加之&#039;, &#039;假如&#039;, &#039;假若&#039;, &#039;假使&#039;, &#039;鉴于&#039;, &#039;将&#039;, &#039;较&#039;, &#039;较之&#039;, &#039;叫&#039;, &#039;接着&#039;, &#039;结果&#039;, &#039;借&#039;, &#039;紧接着&#039;, &#039;进而&#039;, &#039;尽&#039;, &#039;尽管&#039;, &#039;经&#039;, &#039;经过&#039;, &#039;就&#039;, &#039;就是&#039;, &#039;就是说&#039;, &#039;据&#039;, &#039;具体地说&#039;, &#039;具体说来&#039;, &#039;开始&#039;, &#039;开外&#039;, &#039;靠&#039;, &#039;咳&#039;, &#039;可&#039;, &#039;可见&#039;, &#039;可是&#039;, &#039;可以&#039;, &#039;况且&#039;, &#039;啦&#039;, &#039;来&#039;, &#039;来着&#039;, &#039;离&#039;, &#039;例如&#039;, &#039;哩&#039;, &#039;连&#039;, &#039;连同&#039;, &#039;两者&#039;, &#039;临&#039;, &#039;另&#039;, &#039;另外&#039;, &#039;另一方面&#039;, &#039;论&#039;, &#039;嘛&#039;, &#039;吗&#039;, &#039;慢说&#039;, &#039;漫说&#039;, &#039;冒&#039;, &#039;么&#039;, &#039;每&#039;, &#039;每当&#039;, &#039;们&#039;, &#039;莫若&#039;, &#039;某&#039;, &#039;某个&#039;, &#039;某些&#039;, &#039;拿&#039;, &#039;哪&#039;, &#039;哪边&#039;, &#039;哪儿&#039;, &#039;哪个&#039;, &#039;哪里&#039;, &#039;哪年&#039;, &#039;哪怕&#039;, &#039;哪天&#039;, &#039;哪些&#039;, &#039;哪样&#039;, &#039;那&#039;, &#039;那边&#039;, &#039;那儿&#039;, &#039;那个&#039;, &#039;那会儿&#039;, &#039;那里&#039;, &#039;那么&#039;, &#039;那么些&#039;, &#039;那么样&#039;, &#039;那时&#039;, &#039;那些&#039;, &#039;那样&#039;, &#039;乃&#039;, &#039;乃至&#039;, &#039;呢&#039;, &#039;能&#039;, &#039;你&#039;, &#039;你们&#039;, &#039;您&#039;, &#039;宁&#039;, &#039;宁可&#039;, &#039;宁肯&#039;, &#039;宁愿&#039;, &#039;哦&#039;, &#039;呕&#039;, &#039;啪达&#039;, &#039;旁人&#039;, &#039;呸&#039;, &#039;凭&#039;, &#039;凭借&#039;, &#039;其&#039;, &#039;其次&#039;, &#039;其二&#039;, &#039;其他&#039;, &#039;其它&#039;, &#039;其一&#039;, &#039;其余&#039;, &#039;其中&#039;, &#039;起&#039;, &#039;起见&#039;, &#039;起见&#039;, &#039;岂但&#039;, &#039;恰恰相反&#039;, &#039;前后&#039;, &#039;前者&#039;, &#039;且&#039;, &#039;然而&#039;, &#039;然后&#039;, &#039;然则&#039;, &#039;让&#039;, &#039;人家&#039;, &#039;任&#039;, &#039;任何&#039;, &#039;任凭&#039;, &#039;如&#039;, &#039;如此&#039;, &#039;如果&#039;, &#039;如何&#039;, &#039;如其&#039;, &#039;如若&#039;, &#039;如上所述&#039;, &#039;若&#039;, &#039;若非&#039;, &#039;若是&#039;, &#039;啥&#039;, &#039;上下&#039;, &#039;尚且&#039;, &#039;设若&#039;, &#039;设使&#039;, &#039;甚而&#039;, &#039;甚么&#039;, &#039;甚至&#039;, &#039;省得&#039;, &#039;时候&#039;, &#039;什么&#039;, &#039;什么样&#039;, &#039;使得&#039;, &#039;是&#039;, &#039;首先&#039;, &#039;谁&#039;, &#039;谁知&#039;, &#039;顺&#039;, &#039;顺着&#039;,  &#039;虽&#039;, &#039;虽然&#039;, &#039;虽说&#039;, &#039;虽则&#039;, &#039;随&#039;, &#039;随着&#039;, &#039;所&#039;, &#039;所以&#039;, &#039;他&#039;, &#039;他们&#039;, &#039;他人&#039;, &#039;它&#039;, &#039;它们&#039;, &#039;她&#039;, &#039;她们&#039;, &#039;倘&#039;, &#039;倘或&#039;, &#039;倘然&#039;, &#039;倘若&#039;, &#039;倘使&#039;, &#039;腾&#039;, &#039;替&#039;, &#039;通过&#039;, &#039;同&#039;, &#039;同时&#039;, &#039;哇&#039;, &#039;万一&#039;, &#039;往&#039;, &#039;望&#039;, &#039;为&#039;, &#039;为何&#039;, &#039;为什么&#039;, &#039;为着&#039;, &#039;喂&#039;, &#039;嗡嗡&#039;, &#039;我&#039;, &#039;我们&#039;, &#039;呜&#039;, &#039;呜呼&#039;, &#039;乌乎&#039;, &#039;无论&#039;, &#039;无宁&#039;, &#039;毋宁&#039;, &#039;嘻&#039;, &#039;吓&#039;, &#039;相对而言&#039;, &#039;像&#039;, &#039;向&#039;, &#039;向着&#039;, &#039;嘘&#039;, &#039;呀&#039;, &#039;焉&#039;, &#039;沿&#039;, &#039;沿着&#039;, &#039;要&#039;, &#039;要不&#039;, &#039;要不然&#039;, &#039;要不是&#039;, &#039;要么&#039;, &#039;要是&#039;, &#039;也&#039;, &#039;也罢&#039;, &#039;也好&#039;, &#039;一&#039;, &#039;一般&#039;, &#039;一旦&#039;, &#039;一方面&#039;, &#039;一来&#039;, &#039;一切&#039;, &#039;一样&#039;, &#039;一则&#039;, &#039;依&#039;, &#039;依照&#039;, &#039;矣&#039;, &#039;以&#039;, &#039;以便&#039;, &#039;以及&#039;, &#039;以免&#039;, &#039;以至&#039;, &#039;以至于&#039;, &#039;以致&#039;, &#039;抑或&#039;, &#039;因&#039;, &#039;因此&#039;, &#039;因而&#039;, &#039;因为&#039;, &#039;哟&#039;, &#039;用&#039;, &#039;由&#039;, &#039;由此可见&#039;, &#039;由于&#039;, &#039;又&#039;, &#039;于&#039;, &#039;于是&#039;, &#039;于是乎&#039;, &#039;与&#039;, &#039;与此同时&#039;, &#039;与否&#039;, &#039;与其&#039;, &#039;越是&#039;, &#039;云云&#039;, &#039;哉&#039;, &#039;再说&#039;, &#039;再者&#039;, &#039;在&#039;, &#039;在下&#039;, &#039;咱&#039;, &#039;咱们&#039;, &#039;则&#039;, &#039;怎&#039;, &#039;怎么&#039;, &#039;怎么办&#039;, &#039;怎么样&#039;, &#039;怎样&#039;, &#039;咋&#039;, &#039;照&#039;, &#039;照着&#039;, &#039;者&#039;, &#039;这&#039;, &#039;这边&#039;, &#039;这儿&#039;, &#039;这个&#039;, &#039;这会儿&#039;, &#039;这就是说&#039;, &#039;这里&#039;, &#039;这么&#039;, &#039;这么点儿&#039;, &#039;这么些&#039;, &#039;这么样&#039;, &#039;这时&#039;, &#039;这些&#039;, &#039;这样&#039;, &#039;正如&#039;, &#039;吱&#039;, &#039;之&#039;, &#039;之类&#039;, &#039;之所以&#039;, &#039;之一&#039;, &#039;只是&#039;, &#039;只限&#039;, &#039;只要&#039;, &#039;至&#039;, &#039;至于&#039;, &#039;诸位&#039;, &#039;着&#039;, &#039;着呢&#039;, &#039;自&#039;, &#039;自从&#039;, &#039;自个儿&#039;, &#039;自各儿&#039;, &#039;自己&#039;, &#039;自家&#039;, &#039;自身&#039;, &#039;综上所述&#039;, &#039;总而言之&#039;, &#039;总之&#039;, &#039;纵&#039;, &#039;纵令&#039;, &#039;纵然&#039;, &#039;纵使&#039;, &#039;遵照&#039;, &#039;作为&#039;, &#039;兮&#039;, &#039;呃&#039;, &#039;呗&#039;, &#039;咚&#039;, &#039;咦&#039;, &#039;喏&#039;, &#039;啐&#039;, &#039;喔唷&#039;, &#039;嗬&#039;, &#039;嗯&#039;, &#039;嗳&#039;,<br />
				&#039;a\&#039;s&#039;, &#039;able&#039;, &#039;about&#039;, &#039;above&#039;, &#039;according&#039;, &#039;accordingly&#039;, &#039;across&#039;, &#039;actually&#039;,<br />
				&#039;after&#039;, &#039;afterwards&#039;, &#039;again&#039;, &#039;against&#039;, &#039;ain\&#039;t&#039;, &#039;all&#039;, &#039;allow&#039;, &#039;allows&#039;,<br />
				&#039;almost&#039;, &#039;alone&#039;, &#039;along&#039;, &#039;already&#039;, &#039;also&#039;, &#039;although&#039;, &#039;always&#039;, &#039;am&#039;,<br />
				&#039;among&#039;, &#039;amongst&#039;, &#039;an&#039;, &#039;and&#039;, &#039;another&#039;, &#039;any&#039;, &#039;anybody&#039;, &#039;anyhow&#039;,<br />
				&#039;anyone&#039;, &#039;anything&#039;, &#039;anyway&#039;, &#039;anyways&#039;, &#039;anywhere&#039;, &#039;apart&#039;, &#039;appear&#039;, &#039;appreciate&#039;,<br />
				&#039;appropriate&#039;, &#039;are&#039;, &#039;aren\&#039;t&#039;, &#039;around&#039;, &#039;as&#039;, &#039;aside&#039;, &#039;ask&#039;, &#039;asking&#039;,<br />
				&#039;associated&#039;, &#039;at&#039;, &#039;available&#039;, &#039;away&#039;, &#039;awfully&#039;, &#039;be&#039;, &#039;became&#039;, &#039;because&#039;,<br />
				&#039;become&#039;, &#039;becomes&#039;, &#039;becoming&#039;, &#039;been&#039;, &#039;before&#039;, &#039;beforehand&#039;, &#039;behind&#039;, &#039;being&#039;,<br />
				&#039;believe&#039;, &#039;below&#039;, &#039;beside&#039;, &#039;besides&#039;, &#039;best&#039;, &#039;better&#039;, &#039;between&#039;, &#039;beyond&#039;,<br />
				&#039;both&#039;, &#039;brief&#039;, &#039;but&#039;, &#039;by&#039;, &#039;c\&#039;mon&#039;, &#039;c\&#039;s&#039;, &#039;came&#039;, &#039;can&#039;,<br />
				&#039;can\&#039;t&#039;, &#039;cannot&#039;, &#039;cant&#039;, &#039;cause&#039;, &#039;causes&#039;, &#039;certain&#039;, &#039;certainly&#039;, &#039;changes&#039;,<br />
				&#039;clearly&#039;, &#039;co&#039;, &#039;com&#039;, &#039;come&#039;, &#039;comes&#039;, &#039;concerning&#039;, &#039;consequently&#039;, &#039;consider&#039;,<br />
				&#039;considering&#039;, &#039;contain&#039;, &#039;containing&#039;, &#039;contains&#039;, &#039;corresponding&#039;, &#039;could&#039;, &#039;couldn\&#039;t&#039;, &#039;course&#039;,<br />
				&#039;currently&#039;, &#039;definitely&#039;, &#039;described&#039;, &#039;despite&#039;, &#039;did&#039;, &#039;didn\&#039;t&#039;, &#039;different&#039;, &#039;do&#039;,<br />
				&#039;does&#039;, &#039;doesn\&#039;t&#039;, &#039;doing&#039;, &#039;don\&#039;t&#039;, &#039;done&#039;, &#039;down&#039;, &#039;downwards&#039;, &#039;during&#039;,<br />
				&#039;each&#039;, &#039;edu&#039;, &#039;eg&#039;, &#039;eight&#039;, &#039;either&#039;, &#039;else&#039;, &#039;elsewhere&#039;, &#039;enough&#039;,<br />
				&#039;entirely&#039;, &#039;especially&#039;, &#039;et&#039;, &#039;etc&#039;, &#039;even&#039;, &#039;ever&#039;, &#039;every&#039;, &#039;everybody&#039;,<br />
				&#039;everyone&#039;, &#039;everything&#039;, &#039;everywhere&#039;, &#039;ex&#039;, &#039;exactly&#039;, &#039;example&#039;, &#039;except&#039;, &#039;far&#039;,<br />
				&#039;few&#039;, &#039;fifth&#039;, &#039;first&#039;, &#039;five&#039;, &#039;followed&#039;, &#039;following&#039;, &#039;follows&#039;, &#039;for&#039;,<br />
				&#039;former&#039;, &#039;formerly&#039;, &#039;forth&#039;, &#039;four&#039;, &#039;from&#039;, &#039;further&#039;, &#039;furthermore&#039;, &#039;get&#039;,<br />
				&#039;gets&#039;, &#039;getting&#039;, &#039;given&#039;, &#039;gives&#039;, &#039;go&#039;, &#039;goes&#039;, &#039;going&#039;, &#039;gone&#039;,<br />
				&#039;got&#039;, &#039;gotten&#039;, &#039;greetings&#039;, &#039;had&#039;, &#039;hadn\&#039;t&#039;, &#039;happens&#039;, &#039;hardly&#039;, &#039;has&#039;,<br />
				&#039;hasn\&#039;t&#039;, &#039;have&#039;, &#039;haven\&#039;t&#039;, &#039;having&#039;, &#039;he&#039;, &#039;he\&#039;s&#039;, &#039;hello&#039;, &#039;help&#039;,<br />
				&#039;hence&#039;, &#039;her&#039;, &#039;here&#039;, &#039;here\&#039;s&#039;, &#039;hereafter&#039;, &#039;hereby&#039;, &#039;herein&#039;, &#039;hereupon&#039;,<br />
				&#039;hers&#039;, &#039;herself&#039;, &#039;hi&#039;, &#039;him&#039;, &#039;himself&#039;, &#039;his&#039;, &#039;hither&#039;, &#039;hopefully&#039;,<br />
				&#039;how&#039;, &#039;howbeit&#039;, &#039;however&#039;, &#039;i\&#039;d&#039;, &#039;i\&#039;ll&#039;, &#039;i\&#039;m&#039;, &#039;i\&#039;ve&#039;, &#039;ie&#039;,<br />
				&#039;if&#039;, &#039;ignored&#039;, &#039;immediate&#039;, &#039;in&#039;, &#039;inasmuch&#039;, &#039;inc&#039;, &#039;indeed&#039;, &#039;indicate&#039;,<br />
				&#039;indicated&#039;, &#039;indicates&#039;, &#039;inner&#039;, &#039;insofar&#039;, &#039;instead&#039;, &#039;into&#039;, &#039;inward&#039;, &#039;is&#039;,<br />
				&#039;isn\&#039;t&#039;, &#039;it&#039;, &#039;it\&#039;d&#039;, &#039;it\&#039;ll&#039;, &#039;it\&#039;s&#039;, &#039;its&#039;, &#039;itself&#039;, &#039;just&#039;,<br />
				&#039;keep&#039;, &#039;keeps&#039;, &#039;kept&#039;, &#039;know&#039;, &#039;known&#039;, &#039;knows&#039;, &#039;last&#039;, &#039;lately&#039;,<br />
				&#039;later&#039;, &#039;latter&#039;, &#039;latterly&#039;, &#039;least&#039;, &#039;less&#039;, &#039;lest&#039;, &#039;let&#039;, &#039;let\&#039;s&#039;,<br />
				&#039;like&#039;, &#039;liked&#039;, &#039;likely&#039;, &#039;little&#039;, &#039;look&#039;, &#039;looking&#039;, &#039;looks&#039;, &#039;ltd&#039;,<br />
				&#039;mainly&#039;, &#039;many&#039;, &#039;may&#039;, &#039;maybe&#039;, &#039;me&#039;, &#039;mean&#039;, &#039;meanwhile&#039;, &#039;merely&#039;,<br />
				&#039;might&#039;, &#039;more&#039;, &#039;moreover&#039;, &#039;most&#039;, &#039;mostly&#039;, &#039;much&#039;, &#039;must&#039;, &#039;my&#039;,<br />
				&#039;myself&#039;, &#039;name&#039;, &#039;namely&#039;, &#039;nd&#039;, &#039;near&#039;, &#039;nearly&#039;, &#039;necessary&#039;, &#039;need&#039;,<br />
				&#039;needs&#039;, &#039;neither&#039;, &#039;never&#039;, &#039;nevertheless&#039;, &#039;new&#039;, &#039;next&#039;, &#039;nine&#039;, &#039;no&#039;,<br />
				&#039;nobody&#039;, &#039;non&#039;, &#039;none&#039;, &#039;noone&#039;, &#039;nor&#039;, &#039;normally&#039;, &#039;not&#039;, &#039;nothing&#039;,<br />
				&#039;novel&#039;, &#039;now&#039;, &#039;nowhere&#039;, &#039;obviously&#039;, &#039;of&#039;, &#039;off&#039;, &#039;often&#039;, &#039;oh&#039;,<br />
				&#039;ok&#039;, &#039;okay&#039;, &#039;old&#039;, &#039;on&#039;, &#039;once&#039;, &#039;one&#039;, &#039;ones&#039;, &#039;only&#039;,<br />
				&#039;onto&#039;, &#039;or&#039;, &#039;other&#039;, &#039;others&#039;, &#039;otherwise&#039;, &#039;ought&#039;, &#039;our&#039;, &#039;ours&#039;,<br />
				&#039;ourselves&#039;, &#039;out&#039;, &#039;outside&#039;, &#039;over&#039;, &#039;overall&#039;, &#039;own&#039;, &#039;particular&#039;, &#039;particularly&#039;,<br />
				&#039;per&#039;, &#039;perhaps&#039;, &#039;placed&#039;, &#039;please&#039;, &#039;plus&#039;, &#039;possible&#039;, &#039;presumably&#039;, &#039;probably&#039;,<br />
				&#039;provides&#039;, &#039;que&#039;, &#039;quite&#039;, &#039;qv&#039;, &#039;rather&#039;, &#039;rd&#039;, &#039;re&#039;, &#039;really&#039;,<br />
				&#039;reasonably&#039;, &#039;regarding&#039;, &#039;regardless&#039;, &#039;regards&#039;, &#039;relatively&#039;, &#039;respectively&#039;, &#039;right&#039;, &#039;said&#039;,<br />
				&#039;same&#039;, &#039;saw&#039;, &#039;say&#039;, &#039;saying&#039;, &#039;says&#039;, &#039;second&#039;, &#039;secondly&#039;, &#039;see&#039;,<br />
				&#039;seeing&#039;, &#039;seem&#039;, &#039;seemed&#039;, &#039;seeming&#039;, &#039;seems&#039;, &#039;seen&#039;, &#039;self&#039;, &#039;selves&#039;,<br />
				&#039;sensible&#039;, &#039;sent&#039;, &#039;serious&#039;, &#039;seriously&#039;, &#039;seven&#039;, &#039;several&#039;, &#039;shall&#039;, &#039;she&#039;,<br />
				&#039;should&#039;, &#039;shouldn\&#039;t&#039;, &#039;since&#039;, &#039;six&#039;, &#039;so&#039;, &#039;some&#039;, &#039;somebody&#039;, &#039;somehow&#039;,<br />
				&#039;someone&#039;, &#039;something&#039;, &#039;sometime&#039;, &#039;sometimes&#039;, &#039;somewhat&#039;, &#039;somewhere&#039;, &#039;soon&#039;, &#039;sorry&#039;,<br />
				&#039;specified&#039;, &#039;specify&#039;, &#039;specifying&#039;, &#039;still&#039;, &#039;sub&#039;, &#039;such&#039;, &#039;sup&#039;, &#039;sure&#039;,<br />
				&#039;t\&#039;s&#039;, &#039;take&#039;, &#039;taken&#039;, &#039;tell&#039;, &#039;tends&#039;, &#039;th&#039;, &#039;than&#039;, &#039;thank&#039;,<br />
				&#039;thanks&#039;, &#039;thanx&#039;, &#039;that&#039;, &#039;that\&#039;s&#039;, &#039;thats&#039;, &#039;the&#039;, &#039;their&#039;, &#039;theirs&#039;,<br />
				&#039;them&#039;, &#039;themselves&#039;, &#039;then&#039;, &#039;thence&#039;, &#039;there&#039;, &#039;there\&#039;s&#039;, &#039;thereafter&#039;, &#039;thereby&#039;,<br />
				&#039;therefore&#039;, &#039;therein&#039;, &#039;theres&#039;, &#039;thereupon&#039;, &#039;these&#039;, &#039;they&#039;, &#039;they\&#039;d&#039;, &#039;they\&#039;ll&#039;,<br />
				&#039;they\&#039;re&#039;, &#039;they\&#039;ve&#039;, &#039;think&#039;, &#039;third&#039;, &#039;this&#039;, &#039;thorough&#039;, &#039;thoroughly&#039;, &#039;those&#039;,<br />
				&#039;though&#039;, &#039;three&#039;, &#039;through&#039;, &#039;throughout&#039;, &#039;thru&#039;, &#039;thus&#039;, &#039;to&#039;, &#039;together&#039;,<br />
				&#039;too&#039;, &#039;took&#039;, &#039;toward&#039;, &#039;towards&#039;, &#039;tried&#039;, &#039;tries&#039;, &#039;truly&#039;, &#039;try&#039;,<br />
				&#039;trying&#039;, &#039;twice&#039;, &#039;two&#039;, &#039;un&#039;, &#039;under&#039;, &#039;unfortunately&#039;, &#039;unless&#039;, &#039;unlikely&#039;,<br />
				&#039;until&#039;, &#039;unto&#039;, &#039;up&#039;, &#039;upon&#039;, &#039;us&#039;, &#039;use&#039;, &#039;used&#039;, &#039;useful&#039;,<br />
				&#039;uses&#039;, &#039;using&#039;, &#039;usually&#039;, &#039;value&#039;, &#039;various&#039;, &#039;very&#039;, &#039;via&#039;, &#039;viz&#039;,<br />
				&#039;vs&#039;, &#039;want&#039;, &#039;wants&#039;, &#039;was&#039;, &#039;wasn\&#039;t&#039;, &#039;way&#039;, &#039;we&#039;, &#039;we\&#039;d&#039;,<br />
				&#039;we\&#039;ll&#039;, &#039;we\&#039;re&#039;, &#039;we\&#039;ve&#039;, &#039;welcome&#039;, &#039;well&#039;, &#039;went&#039;, &#039;were&#039;, &#039;weren\&#039;t&#039;,<br />
				&#039;what&#039;, &#039;what\&#039;s&#039;, &#039;whatever&#039;, &#039;when&#039;, &#039;whence&#039;, &#039;whenever&#039;, &#039;where&#039;, &#039;where\&#039;s&#039;,<br />
				&#039;whereafter&#039;, &#039;whereas&#039;, &#039;whereby&#039;, &#039;wherein&#039;, &#039;whereupon&#039;, &#039;wherever&#039;, &#039;whether&#039;, &#039;which&#039;,<br />
				&#039;while&#039;, &#039;whither&#039;, &#039;who&#039;, &#039;who\&#039;s&#039;, &#039;whoever&#039;, &#039;whole&#039;, &#039;whom&#039;, &#039;whose&#039;,<br />
				&#039;why&#039;, &#039;will&#039;, &#039;willing&#039;, &#039;wish&#039;, &#039;with&#039;, &#039;within&#039;, &#039;without&#039;, &#039;won\&#039;t&#039;,<br />
				&#039;wonder&#039;, &#039;would&#039;, &#039;wouldn\&#039;t&#039;, &#039;yes&#039;, &#039;yet&#039;, &#039;you&#039;, &#039;you\&#039;d&#039;, &#039;you\&#039;ll&#039;,<br />
				&#039;you\&#039;re&#039;, &#039;you\&#039;ve&#039;, &#039;your&#039;, &#039;yours&#039;, &#039;yourself&#039;, &#039;yourselves&#039;, &#039;zero&#039;<br />
			);<br />
		}<br />
if (in_array(trim($keyword), $stop_words_list)) //单个匹配？？？<br />
		{<br />
			return false;<br />
		}<br />
		<br />
		return true;<br />
	}</code></pre><p class='detail'><br />
<br />
<br />
<br />
匹配还是失效。。。。 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail">models/question.php<br />
<br />
<br />
<br />
</p><pre><code>if ($keyword)<br />
		{<br />
			$where[] = &quot;(MATCH(question_content_fulltext) AGAINST(&#039;&quot; . $this-&gt;model(&#039;search_index&#039;)-&gt;encode_search_code($this-&gt;model(&#039;system&#039;)-&gt;analysis_keyword($keyword)) . &quot;&#039; IN BOOLEAN MODE))&quot;;<br />
		}</code></pre><p class='detail'><br />
<br />
<br />
<br />
analysis_keyword这个类恩。。 一个测试而已,很多过滤用这个类。。。<br />
<br />
<br />
<br />
</p><pre><code>http://wenda.anwsion.com/search/ajax/search_result/search_type-all__q-1%27%29%28;%5C//*where%20if%20and</code></pre><p class='detail'><br />
<br />
<br />
<br />
</p><pre><code>Database error ------ SQL: SELECT *, MATCH(question_content_fulltext) AGAINST(&#039;1&#039;)(;\//*where if and&#039; IN BOOLEAN MODE) AS score FROM aws_question WHERE MATCH(question_content_fulltext) AGAINST(&#039;1&#039;)(;\//*where if and&#039; IN BOOLEAN MODE) ORDER BY score DESC LIMIT 0, 20 Error Message: Mysqli prepare error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#039;(;\//*where if and&#039; IN BOOLEAN MODE) AS score FROM aws_question WHERE MATCH(ques&#039; at line 1</code></pre><p class='detail'><br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/28185152460b495dba6ac32f6159c37bb2b773eb.png" target="_blank"><img src="../images/28185152460b495dba6ac32f6159c37bb2b773eb.png" alt="1.png" width="600"/></a></p><p class="detail"> </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">程序得认真下;1)写代码换输入法啊！ 2)匹配都不匹配儿戏啊！ 3)单个匹配？？？ </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/_Evil" title="_Evil">_Evil</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-015385" title="anwsion一个类设置缺陷导致安全过滤失效，附带一个利用案例">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：高</p>
						<p class="detail">漏洞Rank：15 </p>
													<p class="detail">确认时间：2012-12-02 16:43</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">非常感谢！<br />
匹配那边不是类，是无用关键词的排除。<br />
已经修复并发布了补丁:)谢谢：）</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="15385";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
