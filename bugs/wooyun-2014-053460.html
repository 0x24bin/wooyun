<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		皮皮精灵管理员信息泄漏已入后台  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		皮皮精灵管理员信息泄漏已入后台  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/U神">U神</a> 
</li><li>提交时间：		2014-03-12 22:17</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2014-03-12：	细节已通知厂商并且等待厂商处理中<br/>
									2014-03-13：	厂商已经确认，细节仅向厂商公开<br/>
									2014-03-23：	细节向核心白帽子及相关领域专家公开<br/>
									2014-04-02：	细节向普通白帽子公开<br/>
									2014-04-12：	细节向实习白帽子公开<br/>
									2014-04-26：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail"></p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">皮皮精灵！我们又见面了~看了你们的漏洞修复的完全无缝，感觉你们很注重安全，这是一个非常好的现象，但不知不觉我又进入了你们的两个后台，一个是皮皮精灵管理中心，一个就是Discuz!，这次就不是什么注入漏洞了，而是你们员工的密码问题了！<br />
<br />
--------------------------------------------------------------------------------------------------------------------------<br />
<br />
#1.由于当今的网络安全尚不成熟，某些网站管理员对网站安全不够注重，导致大量网站的数据库被黑客拖走，比如：CSDN、人人网、天涯社区、51CTO的裤子等等，这些数据库从而在网上流传起来，某些黑客则把这些数据库集中起来，然后通过Web形式的查询系统可以从这些数据库中查询任意内容，这样就形成了社工库。而正因为某些人为了方便记忆，或者习惯在多个网站中使用同一个密码，这样就导致了某些人的密码遭受泄漏。<br />
<br />
看完皮皮精灵的漏洞史，我不由的叹道，某几位管理员的密码不够成熟啊！下面我们来看看第一个后台：<br />
<br />
</p><pre><code>http://www.pp.cc/manage/home</code></pre><p class='detail'><br />
<br />
通过上次我对你们提交的那个忽略的漏洞，我们整理出了这么几个账号：<br />
<br />
</p><pre><code>king-t<br />
caocl<br />
ajiong<br />
xman1985<br />
xka2013<br />
Nightyang<br />
xyzhou520<br />
spring0220<br />
westwest2015<br />
leit	<br />
carter0314</code></pre><p class='detail'><br />
<br />
A.密码泄漏问题：<br />
<br />
只是很可惜，绝大多帐号比较普遍，社工起来比较难，然后一个一个通过社工库查询了一下，社工库网址[PS：这可不是我搭建的，网络上开放的]：<br />
<br />
</p><pre><code>http://www.594sgk.com/s/<br />
http://shegongku.org/passwd/<br />
http://www.sojb.pw/</code></pre><p class='detail'><br />
<br />
我们看看“carter0314”这个帐号,通过社工库的查询如下：<br />
<br />
</p><p class="detail"><a href="../images/12194025fdf0fee5f98b804278d734ffc3a7b83f.jpg" target="_blank"><img src="../images/12194025fdf0fee5f98b804278d734ffc3a7b83f.jpg" alt="00.jpg" width="600"/></a></p><p class="detail"><br />
<br />
看来这位朋友在天涯也注册过号，在7k7k也玩过小游戏。然后我通过社工库查询到的密码登录皮皮精灵的后台，然后就悲剧了！<br />
<br />
</p><p class="detail"><a href="../images/12194137157e9150c1434971dc98d15223116d07.jpg" target="_blank"><img src="../images/12194137157e9150c1434971dc98d15223116d07.jpg" alt="01.jpg" width="600"/></a></p><p class="detail"><br />
<br />
B.帐号弱口令行为<br />
<br />
通过对上面多个帐号进行社工，由于某些帐号的样子太普遍难以查到，最后干脆试试弱口令或者帐号密码一样的朋友，最后“xka2013”同志中招了，没想到这位同志的帐号密码居然一样啊，又成功地登录了一个管理员的帐号。如下图：<br />
<br />
</p><p class="detail"><a href="../images/121946193b05f0a23cf584f5ed47ee56a24b3255.jpg" target="_blank"><img src="../images/121946193b05f0a23cf584f5ed47ee56a24b3255.jpg" alt="02.jpg" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
从上面总结出：一种是管理员习惯使用相同的帐号和密码，并且在别的已经泄漏数据库的网站注册过，从而进入了后台，另一种则是弱口令的行为，例如：帐号密码一样、123456、单纯的出生年月日、域名+出生年、域名+当前年份等。 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail">#2.我们再来看看另一个后台是怎么社工进去的！<br />
<br />
第二个后台（可能有危机）：<br />
<br />
</p><pre><code>http://web.youxipai.com/bbs/forum.php</code></pre><p class='detail'><br />
<br />
厂商看起来可能觉得这是刚刚讨论建设的论坛，但是往往小的疏忽可能会带来大的危害，从发的帖子来卡管理员的帐号有哪些：<br />
<br />
</p><pre><code>kingsjj<br />
feisg</code></pre><p class='detail'><br />
<br />
然后试着登录，结果发现“kingsjj”的密码是“123456”。PS:由于太弱改成了&quot;server&quot;<br />
<br />
</p><p class="detail"><a href="../images/121954376a536f0254883e03479883a64fb0f032.jpg" target="_blank"><img src="../images/121954376a536f0254883e03479883a64fb0f032.jpg" alt="03.jpg" width="600"/></a></p><p class="detail"><br />
<br />
但是这个帐号无法进入后台，后来就想肯定不是创始人的，而是被赋予的管理员，然后通过遍历id为1的帐号，发现创始人是&quot;pader&quot;，因为当前也是管理员，所以可以看到创始人的邮箱，而非该权限则看不到创始人的邮箱。<br />
<br />
</p><p class="detail"><a href="../images/12195713e79561073fa29a8f0f6d395105257399.jpg" target="_blank"><img src="../images/12195713e79561073fa29a8f0f6d395105257399.jpg" alt="04.jpg" width="600"/></a></p><p class="detail"><br />
<br />
其实在前面提交那个皮皮精灵sql注入的时候，我先是从这个论坛开始找思路的，本来这个漏洞应该先发的。但是后来还是迅速提交了那个高危害的漏洞，其实我们社工一下这个管理员：<br />
<br />
</p><p class="detail"><a href="../images/1220005130e3738cd322e5461f226bbc6b404bc4.jpg" target="_blank"><img src="../images/1220005130e3738cd322e5461f226bbc6b404bc4.jpg" alt="05.jpg" width="600"/></a></p><p class="detail"><br />
<br />
</p><p class="detail"><a href="../images/12200250c6ccede709186ea950392f7c3234489b.jpg" target="_blank"><img src="../images/12200250c6ccede709186ea950392f7c3234489b.jpg" alt="06.jpg" width="600"/></a></p><p class="detail"><br />
<br />
看的出，这个管理员习惯使用“pader_net”、“pader2009”、“eyangpei”来作密码，于是尝试通过去登录Discuz！可是无法登录，怎么办？其实说到这特别巧，那天正好找到皮皮精灵注入漏洞的时候注入出pader的帐号，然后就尝试可不可能是那个密码呢？最后居然成功的登录了：<br />
<br />
</p><p class="detail"><a href="../images/12200716d00f7ed29296ee265eb4d2636727fa99.jpg" target="_blank"><img src="../images/12200716d00f7ed29296ee265eb4d2636727fa99.jpg" alt="07.jpg" width="600"/></a></p><p class="detail"><br />
<br />
这个创始人还可以进入后台呢~<br />
<br />
</p><p class="detail"><a href="../images/122008102fbb807a13c7a548ef82fae907228721.jpg" target="_blank"><img src="../images/122008102fbb807a13c7a548ef82fae907228721.jpg" alt="08.jpg" width="600"/></a></p><p class="detail"><br />
<br />
也可以进入其它的，例如皮皮商城，<br />
<br />
</p><p class="detail"><a href="../images/122024225ec7be5def0420117940bff8a7c68931.jpg" target="_blank"><img src="../images/122024225ec7be5def0420117940bff8a7c68931.jpg" alt="11.jpg" width="600"/></a></p><p class="detail"><br />
<br />
并且皮皮商城还是个特殊帐号：<br />
<br />
</p><p class="detail"><a href="../images/12203005aa3179a2fd70e8fffad07c52688c2043.jpg" target="_blank"><img src="../images/12203005aa3179a2fd70e8fffad07c52688c2043.jpg" alt="12.jpg" width="600"/></a></p><p class="detail"><br />
<br />
可能你会问，不就进入一个没什么用的后台吗？但是这里却泄漏了你网站的UC_Key~<br />
<br />
</p><p class="detail"><a href="../images/12200936e58a63ed8ce719657d65f3028d163312.jpg" target="_blank"><img src="../images/12200936e58a63ed8ce719657d65f3028d163312.jpg" alt="09.jpg" width="600"/></a></p><p class="detail"><br />
<br />
有UC_Key能干嘛？请厂商看看这个： <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2014-048137">WooYun: Discuz的利用UC_KEY进行getshell</a> <br />
<br />
但是由于本人太菜了，尝试使用UC_key得到webshell始终没有成功，也试过%00截断等等，并通过Discuz!的文件校验工具发现目录是完全可写的，我相信如果遇到@猪猪侠 这样的大牛，绝对是可以通过这个uc_key拿下Webshell的，这样的话“youxipai.com”这个网站就遭殃了~<br />
<br />
其实还有一种拿webshell的方法，但是怕影响到网站什么的，就没有试了，如下先将论坛自动升级到X3.1。<br />
<br />
</p><p class="detail"><a href="../images/122016306ba7352961028755f2d0b87ca153c99a.jpg" target="_blank"><img src="../images/122016306ba7352961028755f2d0b87ca153c99a.jpg" alt="10.jpg" width="600"/></a></p><p class="detail"><br />
<br />
然后通过这个： <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-045603">WooYun:  Discuz! X3.1后台任意代码执行可拿shell</a>  去拿webshell也是可行的~但是我还是放弃了这样的做法。<br />
<br />
<br />
<br />
最后总结一下，假如是骇客入侵，特别是第二个Discuz!的后台，他得到了UC_key，即使在后期论坛管理员密码改了，只要他有uc_key便可以getshell，应该也是行的通的。所以说如果你不想再去建设该论坛，可以直接下线该论坛。 </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">1.最好是告诉所有员工，千万不要使用弱口令（如：654321）、单纯出生年月日（如：19870205）、域名+年份（如“ppcc2011）、帐号密码一样的等等，增强这些管理员的安全意识，再告诉他们曾经在天涯、人人网、CSDN等网站被泄漏的密码一定不要再使用了，社工是很可怕的！<br />
<br />
2.其次是后台应该多隐蔽一些，包括一些不需要的东西完全可以删除，因为小危害会引来大灾难的，注重安全问题，这对你们是有好处的！<br />
<br />
3.对于你们多个后台没有验证码或者错误次数限制来说，这是很容易爆破的！比如皮皮精灵的后台，没有验证码和错误次数，可以通过burpsuite等软件来载入常用密码字典进行爆破的，所以说，你们那些后台请做一些错误次数的限制等等！ </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/U神" title="U神">U神</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-053460" title="皮皮精灵管理员信息泄漏已入后台">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：高</p>
						<p class="detail">漏洞Rank：15 </p>
													<p class="detail">确认时间：2014-03-13 16:38</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">CSDN，天涯之类的网站泄露了用户的数据非常恶心。想不通他们为什么会明文记录密码。</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="53460";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
